<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“å†¬å­£æ—…éŠæŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            font-size: 17px;
            color: #1e293b;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .touch-card {
            transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .touch-card:active {
            transform: scale(0.96);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }

        input, select, textarea { font-size: 17px !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        // ä½¿ç”¨ç°¡å–®çš„ SVG å®šç¾©ç¢ºä¿ç©©å®šæ€§
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Icons = {
            Thermometer: (props) => <IconBase {...props}><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z" /></IconBase>,
            Clock: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></IconBase>,
            MapPin: (props) => <IconBase {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></IconBase>,
            CheckSquare: (props) => <IconBase {...props}><polyline points="9 11 12 14 22 4" /><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" /></IconBase>,
            Plane: (props) => <IconBase {...props}><path d="M2 12h20M15 2l-3 10M9 22l3-10" /></IconBase>,
            Coffee: (props) => <IconBase {...props}><path d="M18 8h1a4 4 0 0 1 0 8h-1" /><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" /><line x1="6" y1="1" x2="6" y2="4" /><line x1="10" y1="1" x2="10" y2="4" /><line x1="14" y1="1" x2="14" y2="4" /></IconBase>,
            Shirt: (props) => <IconBase {...props}><path d="M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z" /></IconBase>,
            Home: (props) => <IconBase {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>,
            Car: (props) => <IconBase {...props}><rect x="1" y="3" width="15" height="13" /><polygon points="16 8 20 8 23 11 23 16 16 16 16 8" /><circle cx="5.5" cy="18.5" r="2.5" /><circle cx="18.5" cy="18.5" r="2.5" /></IconBase>,
            Camera: (props) => <IconBase {...props}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" /><circle cx="12" cy="13" r="4" /></IconBase>,
            AlertTriangle: (props) => <IconBase {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></IconBase>,
            BookOpen: (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>,
            Smartphone: (props) => <IconBase {...props}><rect x="5" y="2" width="14" height="20" rx="2" ry="2" /><line x1="12" y1="18" x2="12.01" y2="18" /></IconBase>,
            ArrowLeft: (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></IconBase>,
            Save: (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></IconBase>,
            Settings: (props) => <IconBase {...props}><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></IconBase>,
            ExternalLink: (props) => <IconBase {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></IconBase>,
            Calendar: (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></IconBase>,
            Train: (props) => <IconBase {...props}><rect x="6" y="4" width="12" height="12" rx="2" /><line x1="6" y1="12" x2="18" y2="12" /><line x1="7" y1="20" x2="17" y2="20" /><line x1="9" y1="16" x2="9" y2="20" /><line x1="15" y1="16" x2="15" y2="20" /></IconBase>,
            PlusCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" /></IconBase>,
            Trash2: (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></IconBase>,
            Snowflake: (props) => <IconBase {...props}><line x1="2" y1="12" x2="22" y2="12" /><line x1="12" y1="2" x2="12" y2="22" /><path d="M20 16.6l-8-4.6-8 4.6" /><path d="M20 7.4l-8 4.6-8-4.6" /><path d="M4 16.6l8-4.6 8 4.6" /><path d="M4 7.4l8 4.6 8-4.6" /></IconBase>,
            Sun: (props) => <IconBase {...props}><circle cx="12" cy="12" r="5" /><line x1="12" y1="1" x2="12" y2="3" /><line x1="12" y1="21" x2="12" y2="23" /><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" /><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" /><line x1="1" y1="12" x2="3" y2="12" /><line x1="21" y1="12" x2="23" y2="12" /><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" /><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" /></IconBase>,
            Cloud: (props) => <IconBase {...props}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" /></IconBase>,
            CloudRain: (props) => <IconBase {...props}><line x1="16" y1="13" x2="16" y2="21" /><line x1="8" y1="13" x2="8" y2="21" /><line x1="12" y1="15" x2="12" y2="23" /><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" /></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6" /></IconBase>,
            CreditCard: (props) => <IconBase {...props}><rect x="1" y="4" width="22" height="16" rx="2" ry="2" /><line x1="1" y1="10" x2="23" y2="10" /></IconBase>,
            Info: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></IconBase>
        };

        const { 
            Thermometer, Clock, MapPin, CheckSquare, 
            Plane, Coffee, Shirt, Home, Car, 
            Camera, AlertTriangle, BookOpen, Smartphone, 
            ArrowLeft, Save, Settings, ExternalLink, Calendar,
            Train, PlusCircle, Trash2, Snowflake, Sun, Cloud, CloudRain,
            ChevronRight, CreditCard, Info
        } = Icons;

        // --- Data ---

        const CITIES = [
            { name: 'æœ­å¹Œ', lat: 43.0667, lon: 141.3500 },
            { name: 'å°æ¨½', lat: 43.1907, lon: 140.9947 },
            { name: 'å‡½é¤¨', lat: 41.7687, lon: 140.7288 },
            { name: 'æ—­å·', lat: 43.7706, lon: 142.3649 },
            { name: 'å¯Œè‰¯é‡', lat: 43.3421, lon: 142.3832 },
            { name: 'ç¾ç‘›', lat: 43.5905, lon: 142.4648 },
        ];

        const CHECKLIST_ITEMS = [
            { category: "è­‰ä»¶èˆ‡è²¡ç‰©", items: ["è­·ç…§ (æ•ˆæœŸ6å€‹æœˆ+)", "Visit Japan Web (æˆªåœ–)", "è­·ç…§å½±æœ¬/ç…§ç‰‡", "æ—¥å¹£ç¾é‡‘ (å°åº—/å¸‚å ´)", "ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜/JCB)", "æ—…éŠä¿éšªå–® (å«ä¸ä¾¿éšª)", "é§•ç…§æ—¥æ–‡è­¯æœ¬ (è‡ªé§•å¿…å‚™)"] },
            { category: "è¡£ç‰© (ç‰ç±³å¼ç©¿æ³•)", items: ["ç™¼ç†±è¡£ (å¸æ¿•æ’æ±—)", "ä¸€èˆ¬é•·è¢– (ä¸­å±¤)", "Gore-tex é˜²é¢¨é˜²æ°´å¤§è¡£", "é˜²æ»‘é›ªé´ (åˆ»ç´‹æ·±)", "åšç¾Šæ¯›è¥ª (å¤šé›™)", "é˜²æ°´æ‰‹å¥— (å¿…å‚™)", "æ¯›å¸½ (é®è€³)", "åœå·¾/åœè„–", "å†°çˆª"] },
            { category: "é›»å­/3C", items: ["æ‰‹æ©Ÿ + å……é›»ç·š", "è¡Œå‹•é›»æº (ä¸å¯è¨—é‹)", "è½‰æ¥é ­ (æ—¥æœ¬é›™æ‰è…³)", "Saily eSIM (å…ˆå®‰è£)", "ç›¸æ©Ÿ + å‚™ç”¨é›»æ± "] },
            { category: "å€‹äººè­·ç†", items: ["å¸¸å‚™è—¥å“ (æ„Ÿå†’/èƒƒè—¥)", "æ¥µæ½¤ä¹³æ¶²/è­·å”‡è†", "æš–æš–åŒ… (è²¼å¼/æ‰‹æ¡)", "å¢¨é¡ (é›ªåœ°åå…‰)", "å£ç½©", "æ‘ºç–Šå‚˜ (é˜²å¤§é›ª)"] },
        ];

        // FIXED: Using 'bg' property correctly for Tailwind classes
        const CATEGORIES = [
            { id: 'food', title: 'é£Ÿãƒ»ç¾é£Ÿ', icon: Coffee, bg: 'bg-orange-500' },
            { id: 'clothing', title: 'è¡£ãƒ»ç©¿æ­', icon: Shirt, bg: 'bg-blue-500' },
            { id: 'stay', title: 'ä½ãƒ»ä½å®¿', icon: Home, bg: 'bg-indigo-500' },
            { id: 'transport', title: 'è¡Œãƒ»äº¤é€š', icon: Train, bg: 'bg-emerald-500' },
            { id: 'payment', title: 'è¡Œå‹•æ”¯ä»˜', icon: CreditCard, bg: 'bg-rose-500' },
            { id: 'fun', title: 'è‚²æ¨‚ãƒ»æ™¯é»', icon: Camera, bg: 'bg-violet-500' },
            { id: 'weather', title: 'å¤©æ°£è³‡è¨Š', icon: Snowflake, bg: 'bg-sky-500' },
            { id: 'safety', title: 'å®‰å…¨ãƒ»é ˆçŸ¥', icon: AlertTriangle, bg: 'bg-red-600' },
            { id: 'prep', title: 'è¡Œå‰æª¢æŸ¥', icon: CheckSquare, bg: 'bg-teal-500' },
            { id: 'saily', title: 'Sailyæ•™å­¸', icon: Smartphone, bg: 'bg-pink-500' },
            { id: 'flight', title: 'æ­æ©Ÿæ³¨æ„', icon: Plane, bg: 'bg-slate-500' },
            { id: 'diary', title: 'æ—…éŠè¨˜äº‹', icon: BookOpen, bg: 'bg-amber-500' },
        ];

        // --- Helper Components ---

        const Card = ({ children, className = "", onClick, noPadding }) => (
            <div 
                onClick={onClick}
                className={`glass-panel rounded-3xl mb-4 overflow-hidden ${noPadding ? '' : 'p-6'} ${onClick ? 'active:scale-98 cursor-pointer touch-card' : ''} ${className}`}
            >
                {children}
            </div>
        );

        const SectionTitle = ({ children }) => (
            <h2 className="text-2xl font-bold text-slate-800 mb-4 mt-8 px-2 flex items-center">
                <span className="w-1.5 h-7 bg-blue-500 rounded-full mr-3"></span>
                {children}
            </h2>
        );

        const ExtLink = ({ href, label, color = "blue" }) => (
            <a href={href} target="_blank" rel="noopener noreferrer" className={`flex items-center justify-between w-full p-4 bg-${color}-50 text-${color}-700 rounded-2xl font-bold text-lg border border-${color}-100 active:bg-${color}-100 mb-3 transition-colors shadow-sm`}>
                <span className="flex items-center gap-3"><ExternalLink size={22} /> {label}</span>
                <ChevronRight size={22} className="opacity-50" />
            </a>
        );

        const Modal = ({ title, content, onClose }) => (
            <div className="fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4 backdrop-blur-md animate-fade-in" onClick={onClose}>
                <div className="bg-white/95 rounded-3xl p-6 w-full max-w-md max-h-[85vh] overflow-y-auto shadow-2xl border border-white/50" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-6 sticky top-0 bg-white/95 backdrop-blur-md -mx-6 -mt-6 p-6 border-b border-gray-100 z-10">
                        <h3 className="text-2xl font-bold text-slate-800">{title}</h3>
                        <button onClick={onClose} className="p-2 bg-gray-100 rounded-full text-gray-500"><ChevronRight className="rotate-90" /></button>
                    </div>
                    <div className="text-lg text-slate-600 leading-relaxed space-y-4 whitespace-pre-line px-1">
                        {content}
                    </div>
                    <button onClick={onClose} className="mt-8 w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-xl shadow-lg active:scale-95 transition-transform">
                        é—œé–‰
                    </button>
                </div>
            </div>
        );

        // --- Widgets ---

        const WeatherWidget = () => {
            const [weatherData, setWeatherData] = useState({});
            const [loading, setLoading] = useState(true);

            const getWeatherIcon = (code) => {
                if (code <= 1) return <Sun className="text-yellow-500" size={32} />;
                if (code <= 3) return <Cloud className="text-gray-400" size={32} />;
                if (code >= 71) return <Snowflake className="text-blue-400" size={32} />;
                return <CloudRain className="text-blue-600" size={32} />;
            };

            useEffect(() => {
                const fetchWeather = async () => {
                    const data = {};
                    try {
                        const targets = CITIES.slice(0, 4); // Show top 4 on home
                        for (const city of targets) {
                            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,weather_code&timezone=Asia%2FTokyo`);
                            const json = await res.json();
                            data[city.name] = {
                                temp: Math.round(json.current.temperature_2m),
                                code: json.current.weather_code
                            };
                        }
                        setWeatherData(data);
                    } catch (e) {
                        console.error("Weather error", e);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchWeather();
            }, []);

            return (
                <div className="grid grid-cols-2 gap-3 mb-6">
                    {CITIES.slice(0, 4).map(city => (
                        <div key={city.name} className="glass-panel p-4 rounded-2xl shadow-sm flex flex-col items-center justify-center relative overflow-hidden">
                            <span className="text-slate-500 text-lg font-bold mb-1">{city.name}</span>
                            {loading ? (
                                <span className="text-gray-400 text-sm">...</span>
                            ) : (
                                <div className="flex items-center gap-3 mt-1">
                                    {getWeatherIcon(weatherData[city.name]?.code)}
                                    <span className={`text-4xl font-extrabold ${weatherData[city.name]?.temp < 0 ? 'text-blue-600' : 'text-slate-700'}`}>
                                        {weatherData[city.name]?.temp}Â°
                                    </span>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );
        };

        const TimeWidget = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);
            
            const format = (offset) => {
                const utc = time.getTime() + (time.getTimezoneOffset() * 60000);
                const local = new Date(utc + (3600000 * offset));
                return local.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            };

            return (
                <div className="flex justify-between items-center bg-slate-800 text-white p-6 rounded-3xl mb-8 shadow-xl">
                    <div className="text-center w-1/2 border-r border-slate-600 pr-4">
                        <div className="text-slate-400 text-sm mb-1 font-medium tracking-widest uppercase">TAIWAN</div>
                        <div className="text-5xl font-bold font-mono tracking-tight text-white">{format(8)}</div>
                    </div>
                    <div className="text-center w-1/2 pl-4">
                        <div className="text-yellow-400 text-sm mb-1 font-bold tracking-widest uppercase">JAPAN</div>
                        <div className="text-5xl font-bold font-mono tracking-tight text-white">{format(9)}</div>
                    </div>
                </div>
            );
        };

        // --- Page Components ---

        const WeatherPage = ({ onBack }) => {
            const [forecasts, setForecasts] = useState({});
            
            useEffect(() => {
                const fetchAll = async () => {
                    const data = {};
                    for(const city of CITIES) {
                        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Asia%2FTokyo`);
                        const json = await res.json();
                        data[city.name] = json.daily;
                    }
                    setForecasts(data);
                };
                fetchAll();
            }, []);

            return (
                <div className="min-h-screen pb-20 animate-slide-up">
                    <div className="glass-header p-6 pb-4 sticky top-0 z-20">
                        <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold text-slate-700 mb-2"><ArrowLeft /> è¿”å›</button>
                        <h1 className="text-3xl font-bold text-slate-800">ä¸€é€±å¤©æ°£é å ±</h1>
                    </div>
                    <div className="p-5 space-y-6">
                        {CITIES.map(city => (
                            <Card key={city.name} className="p-5">
                                <h3 className="text-2xl font-bold text-slate-800 mb-4 border-b pb-2">{city.name}</h3>
                                <div className="flex overflow-x-auto gap-4 pb-2 no-scrollbar">
                                    {forecasts[city.name]?.time.map((date, i) => (
                                        <div key={date} className="flex-shrink-0 flex flex-col items-center min-w-[70px]">
                                            <span className="text-slate-500 text-sm mb-1">{date.slice(5)}</span>
                                            <div className="my-2">
                                                {forecasts[city.name].weather_code[i] >= 71 ? <Snowflake className="text-blue-400" size={28} /> : 
                                                 forecasts[city.name].weather_code[i] <= 3 ? <Sun className="text-yellow-500" size={28} /> : <CloudRain className="text-blue-600" size={28} />}
                                            </div>
                                            <div className="text-sm font-bold">
                                                <span className="text-red-500">{Math.round(forecasts[city.name].temperature_2m_max[i])}Â°</span>
                                                <span className="mx-1">/</span>
                                                <span className="text-blue-500">{Math.round(forecasts[city.name].temperature_2m_min[i])}Â°</span>
                                            </div>
                                        </div>
                                    ))}
                                    {!forecasts[city.name] && <p>è¼‰å…¥ä¸­...</p>}
                                </div>
                            </Card>
                        ))}
                        <SectionTitle>æ™¯é»å¤©æ°£æŸ¥è©¢</SectionTitle>
                        <ExtLink href="https://tenki.jp/leisure/1/" label="Tenki.jp åŒ—æµ·é“æ™¯é»é å ±" color="sky" />
                        <ExtLink href="https://weathernews.jp/s/ski/area/hokkaido.html" label="æ»‘é›ªå ´ç©é›ªæƒ…å ±" color="sky" />
                    </div>
                </div>
            );
        };

        const DiaryView = ({ onBack }) => {
            const [entries, setEntries] = useState(() => JSON.parse(localStorage.getItem('hokkaido_diary_entries') || '[]'));
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5),
                location: '', mapLink: '', weather: 'æ™´', transport: 'æ­¥è¡Œ', cost: '', notes: '', remarks: ''
            });
            const [scriptUrl, setScriptUrl] = useState(() => localStorage.getItem('google_script_url') || 'https://script.google.com/macros/s/AKfycbxi72Nmdpb8l1uOpW7XL9BsquH0O038njQnI_5IRBZzD6xbH3pY6tW7DjTtRK3MOEy4uQ/exec');
            const [showSettings, setShowSettings] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleSave = async () => {
                const newEntry = { ...formData, id: Date.now() };
                const updatedEntries = [newEntry, ...entries];
                setEntries(updatedEntries);
                localStorage.setItem('hokkaido_diary_entries', JSON.stringify(updatedEntries));
                
                if (scriptUrl) {
                    setIsSubmitting(true);
                    try {
                        await fetch(scriptUrl, {
                            method: 'POST', mode: 'no-cors', 
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newEntry)
                        });
                        alert('å·²å„²å­˜ï¼');
                    } catch (e) {
                        alert('å·²å­˜æ–¼æ‰‹æ©Ÿï¼Œä½†é›²ç«¯åŒæ­¥å¤±æ•—ã€‚');
                    } finally {
                        setIsSubmitting(false);
                    }
                } else {
                    alert('å·²å„²å­˜è‡³æ‰‹æ©Ÿï¼');
                }
                setFormData(prev => ({ ...prev, location: '', mapLink: '', cost: '', notes: '', remarks: '' }));
            };

            const handleDelete = (id) => {
                if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                    const newEntries = entries.filter(e => e.id !== id);
                    setEntries(newEntries);
                    localStorage.setItem('hokkaido_diary_entries', JSON.stringify(newEntries));
                }
            };

            return (
                <div className="min-h-screen pb-20 animate-slide-up bg-[#f0f8ff]">
                     <div className="glass-header p-6 pb-4 sticky top-0 z-20">
                        <div className="flex justify-between items-center mb-2">
                            <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold text-slate-700"><ArrowLeft /> è¿”å›</button>
                            <button onClick={() => setShowSettings(!showSettings)} className="p-2 rounded-full bg-slate-100"><Settings size={24} /></button>
                        </div>
                        <h1 className="text-3xl font-bold text-amber-600 flex items-center gap-3"><BookOpen size={32} /> æ—…éŠè¨˜äº‹æœ¬</h1>
                        {showSettings && (
                            <div className="mt-4 bg-white p-4 rounded-xl shadow-lg text-slate-800">
                                <label className="block text-sm font-bold mb-2">Google Apps Script URL:</label>
                                <input type="text" value={scriptUrl} onChange={(e) => { setScriptUrl(e.target.value); localStorage.setItem('google_script_url', e.target.value); }} className="w-full p-3 border rounded-lg text-base" />
                            </div>
                        )}
                    </div>

                    <div className="p-5 space-y-4">
                        <Card className="shadow-xl border-amber-200">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div><label className="text-xs text-slate-500 font-bold uppercase">æ—¥æœŸ</label><input type="date" className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 font-bold uppercase">æ™‚é–“</label><input type="time" className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.time} onChange={e => setFormData({...formData, time: e.target.value})} /></div>
                            </div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">åœ°é»</label><input type="text" placeholder="ä¾‹å¦‚ï¼šå°æ¨½é‹æ²³" className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} /></div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">Google åœ°åœ–é€£çµ</label><div className="flex gap-2 mt-1"><input type="text" placeholder="è²¼ä¸Šé€£çµ" className="w-full p-3 bg-white rounded-xl border border-slate-200" value={formData.mapLink} onChange={e => setFormData({...formData, mapLink: e.target.value})} /><a href="https://maps.google.com" target="_blank" className="p-3 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center"><MapPin /></a></div></div>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div><label className="text-xs text-slate-500 font-bold uppercase">å¤©æ°£</label><select className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.weather} onChange={e => setFormData({...formData, weather: e.target.value})}><option>æ™´</option><option>å¤šé›²</option><option>é™°</option><option>é›ª</option><option>æš´é¢¨é›ª</option><option>é›¨</option></select></div>
                                <div><label className="text-xs text-slate-500 font-bold uppercase">äº¤é€š</label><select className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.transport} onChange={e => setFormData({...formData, transport: e.target.value})}><option>æ­¥è¡Œ</option><option>JRç«è»Š</option><option>åœ°éµ</option><option>å·´å£«</option><option>è¨ˆç¨‹è»Š</option><option>è‡ªé§•</option></select></div>
                            </div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">è²»ç”¨ (æ—¥åœ“)</label><input type="number" placeholder="0" className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.cost} onChange={e => setFormData({...formData, cost: e.target.value})} /></div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">é‡è¦è¨˜äº‹</label><textarea rows="3" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†..." className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})}></textarea></div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">å‚™è¨»</label><input type="text" placeholder="å…¶ä»–å‚™å¿˜..." className="w-full p-3 bg-white rounded-xl border border-slate-200 mt-1" value={formData.remarks} onChange={e => setFormData({...formData, remarks: e.target.value})} /></div>
                            <button onClick={handleSave} disabled={isSubmitting} className="w-full bg-amber-500 text-white font-bold text-xl py-4 rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2">{isSubmitting ? 'å‚³é€ä¸­...' : <><Save /> å„²å­˜ç´€éŒ„</>}</button>
                        </Card>
                        {entries.map(entry => (
                            <div key={entry.id} className="glass-panel p-5 rounded-2xl relative">
                                <button onClick={() => handleDelete(entry.id)} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 p-2"><Trash2 size={20} /></button>
                                <div className="flex items-baseline gap-2 mb-2"><span className="text-lg font-bold text-slate-800">{entry.date}</span><span className="text-slate-500">{entry.time}</span></div>
                                <div className="flex items-center gap-2 text-lg text-blue-700 font-bold mb-2"><MapPin size={18} /> {entry.mapLink ? <a href={entry.mapLink} target="_blank" className="underline">{entry.location}</a> : entry.location}</div>
                                <div className="flex gap-3 mb-3 text-sm text-slate-600"><span className="bg-white/50 px-2 py-1 rounded">{entry.weather}</span><span className="bg-white/50 px-2 py-1 rounded">{entry.transport}</span>{entry.cost && <span className="bg-amber-100 text-amber-800 px-2 py-1 rounded">Â¥{entry.cost}</span>}</div>
                                <p className="text-slate-700 whitespace-pre-wrap text-lg">{entry.notes}</p>
                                {entry.remarks && <p className="text-slate-500 text-sm mt-2 pt-2 border-t border-slate-200">{entry.remarks}</p>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ContentView = ({ category, onBack }) => {
            const [modalContent, setModalContent] = useState(null);
            const catData = CATEGORIES.find(c => c.id === category);

            const content = {
                food: (
                    <>
                        <p className="text-lg text-slate-600 mb-6 font-medium">åŒ—æµ·é“ç¾é£Ÿå››å¤§å¤©ç‹ï¼Œæš–èº«å¿…åƒï¼š</p>
                        <Card onClick={() => setModalContent({title: "æˆå‰æ€æ±—çƒ¤è‚‰", content: "â˜… ç‰¹è‰²ï¼šéµé‹ç‡’çƒ¤ç„¡è…¥å‘³ç¾Šè‚‰ï¼Œè‚‰æ±ç…®ç†Ÿè”¬èœã€‚\nâ˜… ååº—ï¼šé”æ‘© (Daruma)ã€æœ­å¹Œå•¤é…’åœ’ã€‚\nâ˜… ç§˜è¨£ï¼šé…ç™½é£¯è¶…æ­ï¼"})}>
                            <div className="flex items-center gap-4"><div className="bg-orange-100 p-3 rounded-full text-2xl">ğŸ¥©</div><div><strong className="text-xl text-slate-800">æˆå‰æ€æ±—çƒ¤è‚‰</strong><p className="text-slate-500">é®®å«©ç¾Šè‚‰ x ç¨é–€é†¬æ±</p></div></div>
                        </Card>
                        <Card onClick={() => setModalContent({title: "æ¹¯å’–å“©", content: "â˜… ç‰¹è‰²ï¼šè—¥è†³æ¹¯åº•+ç‚¸è”¬èœ+å¤§é›è…¿ã€‚\nâ˜… ååº—ï¼šGARAKUã€Suage+ã€å¥§èŠå•†åº—ã€‚\nâ˜… é»é¤ï¼šé¸æ¹¯åº•â†’ä¸»èœâ†’è¾£åº¦â†’é£¯é‡ã€‚"})}>
                            <div className="flex items-center gap-4"><div className="bg-yellow-100 p-3 rounded-full text-2xl">ğŸ›</div><div><strong className="text-xl text-slate-800">æ¹¯å’–å“©</strong><p className="text-slate-500">æœ­å¹Œéˆé­‚ç¾é£Ÿ</p></div></div>
                        </Card>
                        <Card onClick={() => setModalContent({title: "è±ªè¯æµ·é®®ä¸¼", content: "â˜… å¿…åƒï¼šå¸ç‹èŸ¹ã€æµ·è†½ã€å¹²è²ã€‚\nâ˜… åœ°é»ï¼šå‡½é¤¨æœå¸‚(é‡£çƒè³Š)ã€å°æ¨½ä¸‰è§’å¸‚å ´(æ»æ³¢é£Ÿå ‚)ã€æœ­å¹ŒäºŒæ¡å¸‚å ´ã€‚"})}><div className="flex items-center gap-4"><div className="bg-red-100 p-3 rounded-full text-2xl">ğŸ¦€</div><div><strong className="text-xl text-slate-800">æµ·é®®ä¸¼ / ä¸‰å¤§èŸ¹</strong><p className="text-slate-500">å†¬å­£æœ€è‚¥ç¾</p></div></div></Card>
                        <SectionTitle>å¿«é€ŸæŸ¥è©¢</SectionTitle>
                        <ExtLink href="https://tabelog.com/tw/hokkaido/" label="Tabelog ç¾é£Ÿæ¦œ (ä¸­æ–‡)" color="orange" />
                    </>
                ),
                transport: (
                    <>
                        <SectionTitle>JR éµè·¯å‘¨éŠåˆ¸ (JR Pass)</SectionTitle>
                        <Card onClick={() => setModalContent({title: "JR åŒ—æµ·é“éµè·¯å‘¨éŠåˆ¸", content: "â˜… ç¥¨åƒ¹ (7æ—¥)ï¼šç´„ Â¥29,000 (ä¾åŒ¯ç‡è®Šå‹•)\nâ˜… ç¯„åœï¼šJRåŒ—æµ·é“å…¨ç·š (ç‰¹æ€¥/å¿«é€Ÿ/æ™®é€š)ã€‚\nâ˜… åˆ’ç®—å—ï¼Ÿåªè¦æœ‰ã€Œæœ­å¹Œâ†”å‡½é¤¨ã€ä¾†å›å°±å›æœ¬ã€‚\nâ˜… æ³¨æ„ï¼šç‰¹æ€¥(å¦‚åŒ—æ–—è™Ÿ) å…¨è»ŠæŒ‡å®šå¸­ï¼Œå‹™å¿…å…ˆåŠƒä½ï¼"})}>
                            <h3 className="text-xl font-bold text-emerald-700 mb-1">åŒ—æµ·é“éµè·¯å‘¨éŠåˆ¸</h3>
                            <p className="text-slate-600">é•·è·é›¢ç§»å‹•å¿…å‚™ (å‡½é¤¨/é‡§è·¯)</p>
                        </Card>
                        <ExtLink href="https://www.jrhokkaido.co.jp/global/chinese/ticket/railpass/index.html" label="JR Pass å®˜æ–¹è©³æƒ…èˆ‡è³¼ç¥¨" color="emerald" />
                        
                        <SectionTitle>å…¥å¢ƒæ‰‹çºŒï¼šVisit Japan Web</SectionTitle>
                        <Card onClick={() => setModalContent({title: "æ•¸ä½åŒ–å¿«é€Ÿé€šé—œæ­¥é©Ÿ", content: "1. è¨»å†Šå¸³è™Ÿï¼šVisit Japan Web å®˜ç¶²ã€‚\n2. ç™»éŒ„è¡Œç¨‹ï¼šèˆªç­è³‡è¨Šã€æ—¥æœ¬ä½å®¿åœ°å€ã€‚\n3. å¡«å¯«è³‡æ–™ï¼šå…¥å¢ƒå¯©æŸ¥(å¤–åœ‹äººè¨˜éŒ„) + æµ·é—œç”³å ±ã€‚\n4. å–å¾— QR Codeï¼šé»ƒè‰²(å…¥å¢ƒ) + è—è‰²(æµ·é—œ) å·²åˆä½µç‚ºä¸€å€‹ QR Codeã€‚\n5. æˆªåœ–ä¿å­˜ï¼šå‡ºç™¼å‰å‹™å¿…æˆªåœ–ï¼Œé¿å…æ©Ÿå ´ç¶²è·¯ä¸ç©©ã€‚\nâ˜… 2025æ–°åˆ¶ï¼šéƒ¨åˆ†æ©Ÿå ´æ¨è¡Œé å…ˆé€šé—œï¼Œå¯åœ¨æ¡ƒæ©Ÿå…ˆè¾¦ç†(è©¦è¾¦ä¸­)ã€‚"})}>
                            <h3 className="text-xl font-bold text-blue-700 mb-1">Visit Japan Web æ•™å­¸</h3>
                            <p className="text-slate-600">2025 æœ€æ–°ç‰ˆï¼šQR Code åˆä½µåˆ¶</p>
                        </Card>
                        <ExtLink href="https://vjw-lp.digital.go.jp/zh-hant/" label="Visit Japan Web å®˜ç¶²" color="blue" />
                    </>
                ),
                payment: (
                    <>
                        <SectionTitle>1. è¥¿ç“œå¡ Suica (äº¤é€š/è¶…å•†)</SectionTitle>
                        <Card className="border-l-4 border-green-500 pl-4">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">iPhone ç”¨æˆ¶ (å…å¯¦é«”å¡)</h3>
                            <ol className="list-decimal pl-5 space-y-2 text-slate-700">
                                <li>æ‰“é–‹å…§å»ºã€ŒéŒ¢åŒ… (Wallet)ã€Appã€‚</li>
                                <li>æŒ‰å³ä¸Šã€Œ+ã€>ã€Œäº¤é€šå¡ã€> æœå°‹ã€ŒSuicaã€ã€‚</li>
                                <li>è¼¸å…¥é‡‘é¡ > Apple Pay ä»˜æ¬¾ (å»ºè­°ç”¨ Mastercard/JCB)ã€‚</li>
                                <li><strong>å…è§£é–</strong>ï¼šæ­è»Šæ™‚æ‰‹æ©Ÿç›´æ¥é é–˜é–€å³å¯ã€‚</li>
                            </ol>
                        </Card>
                        <Card className="border-l-4 border-gray-500 pl-4">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">Android ç”¨æˆ¶</h3>
                            <p className="text-slate-600">å°ç£å®‰å“æ‰‹æ©Ÿå¤šä¸æ”¯æ´æ—¥æœ¬ FeliCa æ™¶ç‰‡ã€‚å»ºè­°ï¼š</p>
                            <ul className="list-disc pl-5 mt-1 text-slate-700">
                                <li>è³¼è²·å¯¦é«”å¡ (Suica/Kitaca/ICOCA)ã€‚</li>
                                <li>ä½¿ç”¨ iPhone å®¶äººçš„æ‰‹æ©Ÿç¶å®šå¤šå¼µã€‚</li>
                            </ul>
                        </Card>

                        <SectionTitle>2. PayPay (æƒç¢¼æ”¯ä»˜)</SectionTitle>
                        <Card className="border-l-4 border-rose-500 pl-4">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">å…ä¸‹è¼‰ PayPayï¼Œç›´æ¥ç”¨å°ç£ App</h3>
                            <p className="text-slate-600 mb-3">çœ‹åˆ°ç´…è‰² <span className="text-red-600 font-bold">P</span> PayPay æ¨™èªŒï¼Œç”¨ä»¥ä¸‹ App æƒç¢¼ (å…æ‰‹çºŒè²»)ï¼š</p>
                            <ul className="list-disc pl-5 space-y-1 text-slate-700 font-medium">
                                <li>å…¨æ”¯ä»˜ (PXPay Plus)</li>
                                <li>è¡—å£æ”¯ä»˜ (JKOPay)</li>
                                <li>ç‰å±± Wallet</li>
                            </ul>
                            <div className="mt-3 bg-slate-100 p-3 rounded text-sm text-slate-600">
                                <strong>æ“ä½œï¼š</strong>é–‹ App > åˆ‡æ›åœ°å€ã€Œæ—¥æœ¬ã€ > æƒåº—å®¶ QR Code > è¼¸å…¥æ—¥å¹£é‡‘é¡ã€‚
                            </div>
                        </Card>
                        <ExtLink href="https://livejapan.com/zh-tw/article-a0005219/" label="æ—¥æœ¬è¡Œå‹•æ”¯ä»˜è©³ç´°æ”»ç•¥" color="rose" />
                    </>
                ),
                fun: (
                    <>
                        <SectionTitle>å¿…å»è‚²æ¨‚æ™¯é»</SectionTitle>
                        <div className="space-y-4">
                            <Card onClick={() => setModalContent({title: "æ—­å±±å‹•ç‰©åœ’", content: "â˜… äº®é»ï¼šå†¬å­£é™å®šã€Œä¼éµæ•£æ­¥ã€ï¼Œæ¯æ—¥å…©å ´(11:00/14:30ï¼Œè¦–é›ªæ³èª¿æ•´)ã€‚\nâ˜… å¿…çœ‹ï¼šåŒ—æ¥µç†Šé¤¨ã€æµ·è±¹é¤¨ã€‚\nâ˜… äº¤é€šï¼šæ—­å·ç«™æ­å·´å£«ç´„40åˆ†ã€‚"})}>
                                <strong className="text-xl text-purple-700 block">ğŸ§ æ—­å±±å‹•ç‰©åœ’</strong>
                                <span className="text-slate-600">å†¬å­£ä¼éµæ•£æ­¥æ˜¯é‡é ­æˆ²</span>
                            </Card>
                            <Card onClick={() => setModalContent({title: "ç™½é‡‘é’æ±  (é»ç‡ˆ)", content: "â˜… äº®é»ï¼šå†¬å­£æ¹–é¢çµå†°ä¸¦ç©é›ªï¼Œå¤œæ™šé»ç‡ˆ(Illumination)ç‡Ÿé€ å¤¢å¹»æ°›åœã€‚\nâ˜… æ™‚é–“ï¼šç´„ 17:00~21:00 (ä¾æœˆä»½ä¸åŒ)ã€‚\nâ˜… äº¤é€šï¼šç¾ç‘›ç«™é–‹è»Šæˆ–æ­å·´å£«ã€‚"})}>
                                <strong className="text-xl text-purple-700 block">â„ï¸ ç¾ç‘›ç™½é‡‘é’æ± </strong>
                                <span className="text-slate-600">å¤œæ™šé»ç‡ˆï¼Œå¤¢å¹»è—è‰²ä¸–ç•Œ</span>
                            </Card>
                            <Card onClick={() => setModalContent({title: "å‡½é¤¨ç™¾è¬å¤œæ™¯", content: "â˜… äº®é»ï¼šä¸–ç•Œä¸‰å¤§å¤œæ™¯ä¹‹ä¸€ï¼Œå†¬å­£ç©ºæ°£æ¸…æ¾ˆï¼Œè¦–é‡æœ€æ£’ã€‚\nâ˜… äº¤é€šï¼šæ­ä¹˜å‡½é¤¨å±±çºœè»Šã€‚\nâ˜… å‚™è¨»ï¼šå±±ä¸Šæ¥µå†·ï¼Œå‹™å¿…æˆ´å¸½å­æ‰‹å¥—ã€‚"})}>
                                <strong className="text-xl text-purple-700 block">ğŸŒƒ å‡½é¤¨å±±å¤œæ™¯</strong>
                                <span className="text-slate-600">é›™Cæµ·ç£åœ°å½¢ï¼Œç™¾è¬å¤œæ™¯</span>
                            </Card>
                            <Card onClick={() => setModalContent({title: "å°æ¨½é‹æ²³", content: "â˜… äº®é»ï¼šä¿ç•™ç´…ç£šå€‰åº«ç¾¤ï¼Œå……æ»¿æ‡·èˆŠé¢¨æƒ…ã€‚\nâ˜… æ´»å‹•ï¼š2æœˆã€Œå°æ¨½é›ªç‡ˆè·¯ã€ï¼Œé‹æ²³ä¸Šæ¼‚æµ®ç‡­å…‰ã€‚\nâ˜… å¿…é€›ï¼šå ºç”ºé€šå•†åº—è¡—(ç”œé»ã€ç»ç’ƒé¤¨)ã€‚"})}>
                                <strong className="text-xl text-purple-700 block">ğŸ•¯ï¸ å°æ¨½é‹æ²³</strong>
                                <span className="text-slate-600">æµªæ¼«æ‡·èˆŠï¼Œå¿…é€›å•†åº—è¡—</span>
                            </Card>
                        </div>
                        <ExtLink href="https://www.city.asahikawa.hokkaido.jp/asahiyamazoo/" label="æ—­å±±å‹•ç‰©åœ’å®˜ç¶²" color="purple" />
                        <ExtLink href="https://www.biei-hokkaido.jp/zh-TW/" label="ç¾ç‘›è§€å…‰å”æœƒ (é’æ± è³‡è¨Š)" color="purple" />
                    </>
                ),
                flight: (
                    <>
                        <SectionTitle>å°ç£å‡ºå…¥å¢ƒè¦å®š (2025)</SectionTitle>
                        <Card className="border-l-4 border-red-500">
                            <h3 className="font-bold text-lg text-slate-800 mb-2">ğŸš« ç¦æ­¢å…¥å¢ƒæ”œå¸¶ (å›å°)</h3>
                            <ul className="list-disc pl-5 text-slate-700 space-y-1">
                                <li><strong>è‚‰é¡è£½å“ï¼š</strong>ç«è…¿ã€é¦™è…¸ã€è‚‰ä¹¾ã€å«è‚‰æ³¡éºµ (åš´ç¦è±¬ç˜Ÿç–«å€)ã€‚</li>
                                <li><strong>æ–°é®®è”¬æœï¼š</strong>æ‰€æœ‰æ–°é®®æ°´æœã€è”¬èœã€ç¨®å­ã€‚</li>
                                <li><strong>åŠ ç†±è¸/é›»å­è¸ï¼š</strong>å…¨é¢ç¦æ­¢æ”œå¸¶å…¥å¢ƒã€‚</li>
                            </ul>
                        </Card>
                        <SectionTitle>æ­æ©Ÿå®‰æª¢é€ŸæŸ¥</SectionTitle>
                        <Card className="border-l-4 border-blue-500">
                            <h3 className="font-bold text-lg text-slate-800 mb-2">ğŸ‘œ å¿…é ˆéš¨èº«</h3>
                            <p className="text-slate-600">è¡Œå‹•é›»æºã€é‹°é›»æ± ã€æ‰“ç«æ©Ÿ (é™1å€‹å‚³çµ±å‹)ã€‚</p>
                        </Card>
                        <Card className="border-l-4 border-orange-500">
                            <h3 className="font-bold text-lg text-slate-800 mb-2">ğŸ§³ å¿…é ˆè¨—é‹</h3>
                            <p className="text-slate-600">åˆ€å‰ªé¡ (æŒ‡ç”²å‰ª)ã€è¶…é100ml æ¶²é«”ã€è…³æ¶ (è¶…é60cm)ã€‚</p>
                        </Card>
                    </>
                ),
                safety: (
                    <>
                        <SectionTitle>ğŸ» ç†Šå‡ºæ²’æ³¨æ„</SectionTitle>
                        <Card>
                            <p className="text-slate-700 mb-2">åŒ—æµ·é“å…¨å¢ƒçš†æ˜¯æ£•ç†Šæ£²æ¯åœ°ã€‚è¿‘å¹´ç›®æ“Šå¢åŠ ã€‚</p>
                            <ul className="list-disc pl-5 text-slate-600 text-sm space-y-1">
                                <li>å‹¿å°‡é£Ÿç‰©åƒåœ¾ç•™ç½®æˆ¶å¤–ã€‚</li>
                                <li>æ¸…æ™¨/é»ƒæ˜æ˜¯æ´»å‹•é«˜å³°ï¼Œé¿å…å–®ç¨é€²å…¥å±±æ—ã€‚</li>
                                <li>æ”œå¸¶ç†Šéˆ´ï¼Œç™¼å‡ºè²éŸ³è®“ç†ŠçŸ¥é“äººçš„å­˜åœ¨ã€‚</li>
                                <li><strong>è‹¥é‡è¦‹ç†Šï¼š</strong>ä¿æŒå†·éœï¼Œå®‰éœç·©æ…¢å¾Œé€€ï¼Œ<strong>çµ•å°ä¸è¦è·‘</strong>(æœƒè§¸ç™¼è¿½é€æœ¬èƒ½)ã€‚</li>
                            </ul>
                        </Card>
                        <SectionTitle>âš ï¸ é˜²éœ‡çŸ¥è­˜</SectionTitle>
                        <Card>
                            <p className="text-slate-700 mb-2">æ—¥æœ¬æ˜¯åœ°éœ‡å¤§åœ‹ï¼Œå®¤å…§é‡éœ‡æ™‚ï¼š</p>
                            <ol className="list-decimal pl-5 text-slate-600 text-sm space-y-1">
                                <li><strong>ä¿è­·é ­éƒ¨ï¼š</strong>èº²åœ¨å …å›ºæ¡Œä¸‹ (Drop, Cover, Hold on)ã€‚</li>
                                <li><strong>é é›¢ç»ç’ƒï¼š</strong>çª—æˆ¶ã€æ«ƒå­å¯èƒ½å€’å¡Œç¢è£‚ã€‚</li>
                                <li><strong>ç¢ºä¿å‡ºå£ï¼š</strong>åœ°éœ‡åœæ­¢å¾Œï¼Œæ‰“é–‹é–€çª—ç¢ºä¿é€ƒç”Ÿè·¯ç·šã€‚</li>
                                <li><strong>å‹¿æ­é›»æ¢¯ï¼š</strong>èµ°æ¨“æ¢¯é¿é›£ã€‚</li>
                            </ol>
                        </Card>
                    </>
                ),
                clothing: (
                    <>
                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-xl mb-6 shadow-sm">
                            <p className="text-lg font-bold text-blue-900 mb-1">ç©¿æ­é—œéµï¼šã€Œç‰ç±³å¼ç©¿æ³•ã€</p>
                            <p className="text-base text-blue-800">å®¤å…§æš–æ°£æ¥µå¼· (25Â°C)ï¼Œå®¤å¤–é›¶ä¸‹ (-5Â°C)ã€‚<br/>é‡é»æ˜¯<span className="font-bold text-red-600">ã€Œå…§è–„å¤–åšï¼Œæ–¹ä¾¿ç©¿è„«ã€</span>ï¼Œé€²å®¤å…§è„«å¤§è¡£å³å¯ã€‚</p>
                        </div>
                        <SectionTitle>å»ºè­°è£å‚™</SectionTitle>
                        <div className="space-y-3">
                            <Card noPadding className="p-4 flex gap-4"><span className="bg-blue-100 text-blue-600 px-3 py-1 rounded font-bold">å…§å±¤</span><div><strong>ç™¼ç†±è¡£</strong><span className="text-slate-500 block text-sm">è²¼èº«å¸æ±—ï¼Œå‹¿ç©¿æ£‰è³ªã€‚</span></div></Card>
                            <Card noPadding className="p-4 flex gap-4"><span className="bg-blue-100 text-blue-600 px-3 py-1 rounded font-bold">å¤–å±¤</span><div><strong>é˜²é¢¨é˜²æ°´å¤§è¡£</strong><span className="text-slate-500 block text-sm">é•·ç‰ˆè“‹è‡€ï¼ŒGore-texå°¤ä½³ã€‚</span></div></Card>
                            <Card noPadding className="p-4 flex gap-4"><span className="bg-blue-100 text-blue-600 px-3 py-1 rounded font-bold">è¶³éƒ¨</span><div><strong>é˜²æ»‘é›ªé´ + å†°çˆª</strong><span className="text-slate-500 block text-sm">åˆ»ç´‹æ·±ï¼Œå»ºè­°è²·ç°¡æ˜“å†°çˆªã€‚</span></div></Card>
                        </div>
                    </>
                ),
                stay: (
                    <>
                       <SectionTitle>ä½å®¿é¸æ“‡</SectionTitle>
                       <Card><strong className="text-lg text-indigo-700">å•†å‹™é£¯åº—</strong><p className="text-slate-600">è»Šç«™æ—ä¾¿åˆ©ï¼Œåƒ¹æ ¼å¯¦æƒ ã€‚</p></Card>
                       <Card><strong className="text-lg text-indigo-700">æº«æ³‰æ—…é¤¨</strong><p className="text-slate-600">å®šå±±æºªã€ç™»åˆ¥ã€‚é«”é©—æ¦»æ¦»ç±³èˆ‡æ‡·çŸ³æ–™ç†ã€‚</p></Card>
                       <div className="mt-4 bg-indigo-50 p-4 rounded-xl text-indigo-800">ğŸ’¡ <strong>å»ºè­°ï¼š</strong>é›ªå­£å‹™å¿…é¸ã€Œé›¢åœ°éµè¿‘ã€æˆ–æœ‰ã€Œåœ°ä¸‹é€£é€šé“ã€çš„é£¯åº—ï¼Œé¿å…é›ªåœ°æ‹–è¡Œæã€‚</div>
                    </>
                ),
                prep: (
                    <>
                       <p className="text-lg text-slate-600 mb-4">å‡ºç™¼å‰è«‹é€ä¸€æ ¸å°ï¼Œç¢ºä¿è¬ç„¡ä¸€å¤±ã€‚</p>
                       <button className="w-full bg-teal-500 text-white p-4 rounded-xl text-xl font-bold shadow-lg active:scale-95 transition-transform" onClick={() => document.getElementById('checklist-btn').click()}>
                            é–‹å§‹æª¢æŸ¥æ¸…å–®
                       </button>
                    </>
                ),
                saily: (
                    <>
                        <div className="text-center mb-6">
                            <Smartphone size={48} className="mx-auto text-pink-500 mb-2" />
                            <h3 className="text-xl font-bold text-slate-800">Saily eSIM è¨­å®š</h3>
                            <p className="text-slate-500">å…æ›å¡ï¼Œè½åœ°å³ä¸Šç¶²</p>
                        </div>
                        <SectionTitle>é—œéµæ­¥é©Ÿ</SectionTitle>
                        <div className="space-y-4">
                            <Card noPadding className="p-4 flex gap-4 items-center">
                                <div className="w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center font-bold">1</div>
                                <div><strong className="block text-slate-800">åœ¨å°ç£å®‰è£</strong><span className="text-slate-600 text-sm">æœ‰ç¶²è·¯æ™‚å…ˆè³¼è²·ä¸¦ "Install eSIM"ã€‚</span></div>
                            </Card>
                            <Card noPadding className="p-4 flex gap-4 items-center">
                                <div className="w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center font-bold">2</div>
                                <div><strong className="block text-slate-800">æŠµé”å¾Œå•Ÿç”¨</strong><span className="text-slate-600 text-sm">é–‹å•Ÿã€Œå•Ÿç”¨æ­¤è™Ÿç¢¼ã€èˆ‡ <span className="text-red-500 font-bold">æ•¸æ“šæ¼«éŠ</span>ã€‚</span></div>
                            </Card>
                        </div>
                        <div className="mt-6">
                            <ExtLink href="https://support.saily.com/hc/zh-tw/categories/12777342059164" label="Saily å®˜æ–¹è©³ç´°æ•™å­¸" color="pink" />
                        </div>
                    </>
                )
            };

            const defaultContent = (
                <div className="text-center py-20">
                    <p className="text-xl text-slate-400">æœ¬é é¢å…§å®¹å»ºç½®ä¸­...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 animate-slide-up">
                    <div className={`glass-header p-6 pb-4 sticky top-0 z-20`}>
                        <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold text-slate-700 mb-2"><ArrowLeft /> è¿”å›</button>
                        <h1 className="text-3xl font-bold text-slate-800 flex items-center gap-3">
                            <catData.icon size={36} className={catData.bg.replace('bg-', 'text-')} />
                            {catData.title}
                        </h1>
                    </div>
                    <div className="p-5">
                        {content[category] || defaultContent}
                    </div>
                    {modalContent && <Modal title={modalContent.title} content={modalContent.content} onClose={() => setModalContent(null)} />}
                </div>
            );
        };

        const ChecklistView = ({ onBack }) => {
            const [checked, setChecked] = useState(() => JSON.parse(localStorage.getItem('hokkaido_checklist_v3') || '{}'));
            const toggleCheck = (item) => {
                const newChecked = { ...checked, [item]: !checked[item] };
                setChecked(newChecked);
                localStorage.setItem('hokkaido_checklist_v3', JSON.stringify(newChecked));
            };
            const progress = Math.round((Object.values(checked).filter(Boolean).length / CHECKLIST_ITEMS.reduce((a,c)=>a+c.items.length,0)) * 100);

            return (
                <div className="min-h-screen pb-20 animate-slide-up">
                    <div className="glass-header p-6 sticky top-0 z-20">
                        <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold text-slate-700 mb-4"><ArrowLeft /> è¿”å›</button>
                        <div className="flex justify-between items-end">
                            <h1 className="text-3xl font-bold text-teal-700">è¡Œå‰æª¢æŸ¥</h1>
                            <span className="text-5xl font-bold text-teal-600">{progress}%</span>
                        </div>
                        <div className="w-full bg-gray-200 h-3 rounded-full mt-4 overflow-hidden">
                            <div className="bg-teal-500 h-full transition-all duration-500" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>
                    <div className="p-5 space-y-6">
                        {CHECKLIST_ITEMS.map((cat, idx) => (
                            <div key={idx}>
                                <h3 className="text-lg font-bold text-teal-800 mb-3 ml-1">{cat.category}</h3>
                                <div className="glass-panel rounded-2xl overflow-hidden">
                                    {cat.items.map((item) => (
                                        <div key={item} onClick={() => toggleCheck(item)} className="flex items-center p-4 border-b border-gray-100 last:border-0 active:bg-teal-50 transition-colors cursor-pointer">
                                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center mr-4 transition-all ${checked[item] ? 'bg-teal-500 border-teal-500' : 'border-slate-300'}`}>
                                                {checked[item] && <CheckSquare className="text-white" size={16} />}
                                            </div>
                                            <span className={`text-lg flex-1 ${checked[item] ? 'text-slate-400 line-through' : 'text-slate-700'}`}>{item}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [view, setView] = useState('home');
            
            useEffect(() => {
                const handlePopState = (e) => setView(e.state?.view || 'home');
                window.addEventListener('popstate', handlePopState);
                return () => window.removeEventListener('popstate', handlePopState);
            }, []);

            const navigate = (v) => {
                window.history.pushState({ view: v }, '', '');
                setView(v);
                window.scrollTo(0, 0);
            };

            if (view === 'checklist') return <ChecklistView onBack={() => navigate('home')} />;
            if (view === 'diary') return <DiaryView onBack={() => navigate('home')} />;
            if (view === 'weather') return <WeatherPage onBack={() => navigate('home')} />;
            if (view !== 'home') return <ContentView category={view} onBack={() => navigate('home')} />;

            return (
                <div className="min-h-screen pb-10 font-sans">
                    <div className="bg-gradient-to-br from-blue-600 to-indigo-700 p-6 pb-12 rounded-b-[3rem] shadow-xl mb-6 text-white relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-16 -mt-16 blur-3xl pointer-events-none"></div>
                        <h1 className="text-3xl font-bold mb-1 text-center drop-shadow-md">åŒ—æµ·é“å†¬å­£æ—…éŠ</h1>
                        <p className="text-blue-200 text-center text-sm tracking-widest uppercase mb-6">Hokkaido Winter Guide</p>
                        <TimeWidget />
                    </div>

                    <div className="px-5 -mt-8 relative z-10">
                        <WeatherWidget />
                        
                        <div className="grid grid-cols-2 gap-4">
                            {CATEGORIES.map(cat => (
                                <div 
                                    key={cat.id}
                                    onClick={() => navigate(cat.id === 'prep' ? 'checklist' : cat.id === 'diary' ? 'diary' : cat.id === 'weather' ? 'weather' : cat.id)}
                                    id={cat.id === 'prep' ? 'checklist-btn' : ''}
                                    className={`bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 aspect-[1.1] active:scale-95 transition-transform cursor-pointer relative overflow-hidden group`}
                                >
                                    <div className={`absolute top-0 right-0 w-16 h-16 bg-gradient-to-br ${cat.bg.replace('bg-', 'from-').replace('500', '400')} to-white opacity-20 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110`}></div>
                                    <div className={`p-4 rounded-full ${cat.bg} text-white shadow-lg`}>
                                        <cat.icon size={28} />
                                    </div>
                                    <span className="font-bold text-lg text-slate-700">{cat.title}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <footer className="mt-16 text-center text-slate-400 text-sm pb-8 px-8">
                        <div className="w-12 h-1 bg-slate-200 mx-auto rounded-full mb-4"></div>
                        <p className="mb-2">ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼æ³¨æ„ä¿æš–èˆ‡å®‰å…¨ã€‚</p>
                        <p className="text-xs opacity-60">Copyright Â© 2025 æ§‹æ€by Carey | å¯¦ç”¨å°å·¥å…·</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
