<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“å†¬å­£æ—…éŠæŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f8ff; /* AliceBlue */
            -webkit-tap-highlight-color: transparent;
            font-size: 16px;
            color: #334155;
        }
        
        /* Custom Scrollbar for hidden look but functional */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Touch Interactions */
        .touch-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .touch-card:active {
            transform: scale(0.97);
            background-color: #f1f5f9;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Input styling to prevent zoom on iOS */
        input, select, textarea {
            font-size: 16px !important; 
        }

        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (Internal SVG to ensure stability) ---
        const createIcon = (paths, attrs = {}) => (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className || ""} {...attrs}>
                {paths.map((p, i) => <path key={i} d={p} />)}
            </svg>
        );

        const Icons = {
            Thermometer: createIcon(["M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"]),
            Clock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            MapPin: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            CheckSquare: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>,
            Plane: createIcon(["M2 12h20M15 2l-3 10M9 22l3-10"]),
            Coffee: createIcon(["M18 8h1a4 4 0 0 1 0 8h-1", "M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z", "M6 1v3", "M10 1v3", "M14 1v3"]),
            Shirt: createIcon(["M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"]),
            Home: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
            Car: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>,
            Camera: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>,
            AlertTriangle: createIcon(["M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z", "M12 9v4", "M12 17h.01"]),
            BookOpen: createIcon(["M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z", "M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"]),
            Smartphone: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></svg>,
            ArrowLeft: createIcon(["M19 12H5", "M12 19l-7-7 7-7"]),
            Save: createIcon(["M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z", "M17 21v-8H7v8", "M7 3v5h8"]),
            Settings: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            ExternalLink: createIcon(["M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6", "M15 3h6v6", "M10 14L21 3"]),
            Calendar: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Train: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="6" y="4" width="12" height="12" rx="2"></rect><line x1="6" y1="12" x2="18" y2="12"></line><line x1="7" y1="20" x2="17" y2="20"></line><line x1="9" y1="16" x2="9" y2="20"></line><line x1="15" y1="16" x2="15" y2="20"></line></svg>,
            PlusCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>,
            Trash2: createIcon(["M3 6h18", "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", "M10 11v6", "M14 11v6"]),
            Snowflake: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line><path d="M20 16.6l-8-4.6-8 4.6"></path><path d="M20 7.4l-8 4.6-8-4.6"></path></svg>,
            Sun: createIcon(["M12 1v2", "M12 21v2", "M4.22 4.22l1.42 1.42", "M18.36 18.36l1.42 1.42", "M1 12h2", "M21 12h2", "M4.22 19.78l1.42-1.42", "M18.36 5.64l1.42-1.42", "M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"]),
            Cloud: createIcon(["M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"]),
            CloudRain: createIcon(["M16 13v8", "M8 13v8", "M12 15v8", "M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"]),
            ChevronRight: createIcon(["M9 18l6-6-6-6"]),
            CreditCard: createIcon(["M1 4h22v16H1z", "M1 10h22"]),
            Info: (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size||24} height={props.size||24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        };

        const { 
            Thermometer, Clock, MapPin, CheckSquare, 
            Plane, Coffee, Shirt, Home, Car, 
            Camera, AlertTriangle, BookOpen, Smartphone, 
            ArrowLeft, Save, Settings, ExternalLink, Calendar,
            Train, PlusCircle, Trash2, Snowflake, Sun, Cloud, CloudRain,
            ChevronRight, CreditCard, Info
        } = Icons;

        // --- Data ---

        const CITIES = [
            { name: 'æœ­å¹Œ', lat: 43.0667, lon: 141.3500 },
            { name: 'å°æ¨½', lat: 43.1907, lon: 140.9947 },
            { name: 'å‡½é¤¨', lat: 41.7687, lon: 140.7288 },
            { name: 'æ—­å·', lat: 43.7706, lon: 142.3649 },
        ];

        const CHECKLIST_ITEMS = [
            { category: "è­‰ä»¶èˆ‡è²¡ç‰©", items: ["è­·ç…§ (æ•ˆæœŸ6å€‹æœˆ+)", "Visit Japan Web QR Code (æˆªåœ–)", "è­·ç…§å½±æœ¬/ç…§ç‰‡", "æ—¥å¹£ç¾é‡‘ (å°åº—/å¸‚å ´ç”¨)", "ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜/JCB)", "æ—…éŠä¿éšªå–® (å«ä¸ä¾¿éšª)", "åœ‹éš›é§•ç…§ (è‹¥è‡ªé§•, éœ€æ—¥æ–‡è­¯æœ¬)"] },
            { category: "è¡£ç‰© (ç‰ç±³å¼)", items: ["ç™¼ç†±è¡£ (å¸æ¿•æ’æ±—)", "ä¸€èˆ¬é•·è¢–/æ¯›è¡£ (ä¸­å±¤)", "é˜²é¢¨é˜²æ°´å¤–å¥— (Gore-texå°¤ä½³)", "é˜²æ°´é˜²æ»‘é›ªé´ (åˆ»ç´‹æ·±)", "åšç¾Šæ¯›è¥ª (å¤šå¸¶å¹¾é›™)", "é˜²æ°´æ‰‹å¥— (å¿…å‚™)", "æ¯›å¸½ (éœ€è“‹ä½è€³æœµ)", "åœå·¾/è„–åœ", "å†°çˆª (ä¾¿åˆ©å•†åº—å¯è²·)"] },
            { category: "é›»å­/3C", items: ["æ‰‹æ©Ÿ + å……é›»ç·š", "è¡Œå‹•é›»æº (ä¸å¯è¨—é‹)", "è½‰æ¥é ­ (æ—¥æœ¬é›™æ‰è…³)", "Saily eSIM (å‡ºç™¼å‰å®‰è£)", "ç›¸æ©Ÿ + å‚™ç”¨é›»æ±  (å¤©å†·è€—é›»å¿«)"] },
            { category: "å€‹äººè­·ç†", items: ["å¸¸å‚™è—¥å“ (æ„Ÿå†’/èƒƒè—¥/æ­¢ç—›)", "æ¥µæ½¤ä¹³æ¶²/è­·æ‰‹éœœ (è¶…ä¹¾ç‡¥)", "è­·å”‡è†", "æš–æš–åŒ… (è²¼å¼/æ‰‹æ¡)", "å¢¨é¡ (é›ªåœ°åå…‰å¼·)", "å£ç½© (é˜²å¯’/é˜²ç–«)", "æ‘ºç–Šå‚˜ (é˜²å¤§é›ª)"] },
        ];

        const CATEGORIES = [
            { id: 'food', title: 'é£Ÿãƒ»ç¾é£Ÿ', icon: Coffee, color: 'from-orange-400 to-red-500' },
            { id: 'clothing', title: 'è¡£ãƒ»ç©¿æ­', icon: Shirt, color: 'from-blue-400 to-indigo-500' },
            { id: 'stay', title: 'ä½ãƒ»ä½å®¿', icon: Home, color: 'from-indigo-400 to-purple-500' },
            { id: 'transport', title: 'è¡Œãƒ»äº¤é€š', icon: Train, color: 'from-emerald-400 to-teal-500' },
            { id: 'payment', title: 'è¡Œå‹•æ”¯ä»˜', icon: CreditCard, color: 'from-rose-400 to-pink-500' },
            { id: 'fun', title: 'è‚²æ¨‚ãƒ»æ™¯é»', icon: Camera, color: 'from-violet-400 to-fuchsia-500' },
            { id: 'weather', title: 'å¤©æ°£è³‡è¨Š', icon: Snowflake, color: 'from-sky-400 to-cyan-500' },
            { id: 'safety', title: 'å®‰å…¨ãƒ»é ˆçŸ¥', icon: AlertTriangle, color: 'from-red-500 to-rose-600' },
            { id: 'prep', title: 'è¡Œå‰æª¢æŸ¥', icon: CheckSquare, color: 'from-teal-400 to-green-500' },
            { id: 'saily', title: 'Sailyæ•™å­¸', icon: Smartphone, color: 'from-pink-400 to-rose-500' },
            { id: 'flight', title: 'æ­æ©Ÿæ³¨æ„', icon: Plane, color: 'from-slate-500 to-gray-600' },
            { id: 'diary', title: 'æ—…éŠè¨˜äº‹', icon: BookOpen, color: 'from-amber-400 to-yellow-500' },
        ];

        // --- Helper Components ---

        const Card = ({ children, className = "", onClick, noPadding }) => (
            <div 
                onClick={onClick}
                className={`bg-white rounded-2xl shadow-lg border border-slate-100 mb-4 overflow-hidden ${noPadding ? '' : 'p-5'} ${onClick ? 'active:scale-98 cursor-pointer touch-card' : ''} ${className}`}
            >
                {children}
            </div>
        );

        const SectionTitle = ({ children }) => (
            <h2 className="text-xl font-bold text-slate-800 mb-4 mt-8 flex items-center">
                <span className="w-1.5 h-6 bg-blue-500 rounded-full mr-3"></span>
                {children}
            </h2>
        );

        const ExtLink = ({ href, label, color = "blue" }) => (
            <a href={href} target="_blank" rel="noopener noreferrer" className={`flex items-center justify-between w-full p-4 bg-${color}-50 text-${color}-700 rounded-xl font-bold text-lg border border-${color}-100 active:bg-${color}-100 mb-3 transition-colors shadow-sm`}>
                <span className="flex items-center gap-2"><ExternalLink size={20} /> {label}</span>
                <ChevronRight size={20} className="opacity-50" />
            </a>
        );

        const DetailModal = ({ title, content, onClose }) => (
            <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in" onClick={onClose}>
                <div className="bg-white rounded-2xl p-6 w-full max-w-md max-h-[85vh] overflow-y-auto shadow-2xl" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-4 border-b pb-2">
                        <h3 className="text-2xl font-bold text-slate-800">{title}</h3>
                        <button onClick={onClose} className="p-2 bg-slate-100 rounded-full text-slate-500"><ChevronRight className="rotate-90" /></button>
                    </div>
                    <div className="text-lg text-slate-600 leading-relaxed space-y-4 whitespace-pre-line">
                        {content}
                    </div>
                    <button onClick={onClose} className="mt-6 w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg active:bg-blue-700 transition-colors">
                        é—œé–‰
                    </button>
                </div>
            </div>
        );

        // --- Widgets ---

        const WeatherWidget = () => {
            const [weatherData, setWeatherData] = useState({});
            const [loading, setLoading] = useState(true);

            const getWeatherIcon = (code) => {
                if (code <= 1) return <Sun className="text-yellow-500" size={32} />;
                if (code <= 3) return <Cloud className="text-gray-400" size={32} />;
                if (code >= 71) return <Snowflake className="text-blue-400" size={32} />;
                return <CloudRain className="text-blue-600" size={32} />;
            };

            useEffect(() => {
                const fetchWeather = async () => {
                    const data = {};
                    try {
                        for (const city of CITIES) {
                            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,weather_code&timezone=Asia%2FTokyo`);
                            const json = await res.json();
                            data[city.name] = {
                                temp: Math.round(json.current.temperature_2m),
                                code: json.current.weather_code
                            };
                        }
                        setWeatherData(data);
                    } catch (e) {
                        console.error("Weather fetch failed", e);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchWeather();
            }, []);

            return (
                <div className="grid grid-cols-2 gap-3 mb-6">
                    {CITIES.map(city => (
                        <div key={city.name} className="glass p-4 rounded-2xl shadow-sm flex flex-col items-center justify-center border border-white/50 relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 to-cyan-300"></div>
                            <span className="text-slate-500 text-lg font-bold mb-1">{city.name}</span>
                            {loading ? (
                                <span className="text-gray-400 text-sm">è®€å–ä¸­...</span>
                            ) : (
                                <div className="flex items-center gap-3 mt-1">
                                    {getWeatherIcon(weatherData[city.name]?.code)}
                                    <span className={`text-4xl font-extrabold ${weatherData[city.name]?.temp < 0 ? 'text-blue-600' : 'text-slate-700'}`}>
                                        {weatherData[city.name]?.temp}Â°
                                    </span>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );
        };

        const TimeWidget = () => {
            const [time, setTime] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const formatTime = (date, offset) => {
                const utc = date.getTime() + (date.getTimezoneOffset() * 60000);
                const localDate = new Date(utc + (3600000 * offset));
                return localDate.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            };

            return (
                <div className="flex justify-between items-center bg-slate-800 text-white p-6 rounded-3xl mb-6 shadow-xl relative overflow-hidden">
                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                    <div className="text-center w-1/2 border-r border-slate-600 pr-4 z-10">
                        <div className="text-slate-400 text-sm mb-1 uppercase tracking-wider">å°ç£æ™‚é–“</div>
                        <div className="text-4xl font-bold font-mono">{formatTime(time, 8)}</div>
                    </div>
                    <div className="text-center w-1/2 pl-4 z-10">
                        <div className="text-yellow-400 text-sm mb-1 font-bold uppercase tracking-wider">æ—¥æœ¬æ™‚é–“</div>
                        <div className="text-4xl font-bold font-mono">{formatTime(time, 9)}</div>
                    </div>
                </div>
            );
        };

        // --- Pages ---

        const DiaryView = ({ onBack }) => {
            const [entries, setEntries] = useState(() => JSON.parse(localStorage.getItem('hokkaido_diary_entries') || '[]'));
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 5),
                location: '', mapLink: '', weather: 'æ™´', transport: 'æ­¥è¡Œ', cost: '', notes: '', remarks: ''
            });
            const [scriptUrl, setScriptUrl] = useState(() => localStorage.getItem('google_script_url') || 'https://script.google.com/macros/s/AKfycbxi72Nmdpb8l1uOpW7XL9BsquH0O038njQnI_5IRBZzD6xbH3pY6tW7DjTtRK3MOEy4uQ/exec');
            const [showSettings, setShowSettings] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleSave = async () => {
                const newEntry = { ...formData, id: Date.now() };
                const updatedEntries = [newEntry, ...entries];
                setEntries(updatedEntries);
                localStorage.setItem('hokkaido_diary_entries', JSON.stringify(updatedEntries));
                
                if (scriptUrl) {
                    setIsSubmitting(true);
                    try {
                        await fetch(scriptUrl, {
                            method: 'POST', mode: 'no-cors', 
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newEntry)
                        });
                        alert('å·²å„²å­˜ï¼');
                    } catch (e) {
                        alert('å·²å­˜æ–¼æ‰‹æ©Ÿï¼Œä½†é›²ç«¯åŒæ­¥å¤±æ•—ã€‚');
                    } finally {
                        setIsSubmitting(false);
                    }
                } else {
                    alert('å·²å„²å­˜è‡³æ‰‹æ©Ÿï¼');
                }
                setFormData(prev => ({ ...prev, location: '', mapLink: '', cost: '', notes: '', remarks: '' }));
            };

            const handleDelete = (id) => {
                if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) {
                    const newEntries = entries.filter(e => e.id !== id);
                    setEntries(newEntries);
                    localStorage.setItem('hokkaido_diary_entries', JSON.stringify(newEntries));
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 pb-20 animate-fade-in">
                     <div className="bg-gradient-to-br from-amber-400 to-yellow-500 text-white p-6 pb-8 rounded-b-[2.5rem] shadow-lg sticky top-0 z-20">
                        <div className="flex justify-between items-center mb-4">
                            <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold opacity-90 active:opacity-60"><ArrowLeft /> è¿”å›</button>
                            <button onClick={() => setShowSettings(!showSettings)} className="p-2 rounded-full bg-white/20"><Settings size={24} /></button>
                        </div>
                        <h1 className="text-3xl font-bold flex items-center gap-3"><BookOpen size={32} /> æ—…éŠè¨˜äº‹æœ¬</h1>
                        {showSettings && (
                            <div className="mt-4 bg-white p-4 rounded-xl shadow-lg text-slate-800">
                                <label className="block text-sm font-bold mb-2">Google Apps Script URL:</label>
                                <input type="text" value={scriptUrl} onChange={(e) => { setScriptUrl(e.target.value); localStorage.setItem('google_script_url', e.target.value); }} className="w-full p-3 border rounded-lg text-base" />
                            </div>
                        )}
                    </div>

                    <div className="p-5 space-y-4 -mt-4">
                        <Card className="shadow-xl">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div><label className="text-xs text-slate-500 font-bold uppercase">æ—¥æœŸ</label><input type="date" className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 font-bold uppercase">æ™‚é–“</label><input type="time" className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.time} onChange={e => setFormData({...formData, time: e.target.value})} /></div>
                            </div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">åœ°é»</label><input type="text" placeholder="ä¾‹å¦‚ï¼šå°æ¨½é‹æ²³" className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} /></div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">Google åœ°åœ–é€£çµ</label><div className="flex gap-2 mt-1"><input type="text" placeholder="è²¼ä¸Šé€£çµ" className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200" value={formData.mapLink} onChange={e => setFormData({...formData, mapLink: e.target.value})} /><a href="https://maps.google.com" target="_blank" className="p-3 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center"><MapPin /></a></div></div>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div><label className="text-xs text-slate-500 font-bold uppercase">å¤©æ°£</label><select className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.weather} onChange={e => setFormData({...formData, weather: e.target.value})}><option>æ™´</option><option>å¤šé›²</option><option>é™°</option><option>é›ª</option><option>æš´é¢¨é›ª</option><option>é›¨</option></select></div>
                                <div><label className="text-xs text-slate-500 font-bold uppercase">äº¤é€š</label><select className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.transport} onChange={e => setFormData({...formData, transport: e.target.value})}><option>æ­¥è¡Œ</option><option>JRç«è»Š</option><option>åœ°éµ</option><option>å·´å£«</option><option>è¨ˆç¨‹è»Š</option><option>è‡ªé§•</option></select></div>
                            </div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">è²»ç”¨ (æ—¥åœ“)</label><input type="number" placeholder="0" className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.cost} onChange={e => setFormData({...formData, cost: e.target.value})} /></div>
                            <div className="mb-4"><label className="text-xs text-slate-500 font-bold uppercase">é‡è¦è¨˜äº‹</label><textarea rows="3" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†..." className="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 mt-1" value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})}></textarea></div>
                            <button onClick={handleSave} disabled={isSubmitting} className="w-full bg-yellow-500 text-white font-bold text-xl py-4 rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2">{isSubmitting ? 'å‚³é€ä¸­...' : <><Save /> å„²å­˜ç´€éŒ„</>}</button>
                        </Card>
                        <h3 className="text-xl font-bold text-slate-700 ml-2 mt-8">æ­·å²ç´€éŒ„</h3>
                        {entries.map(entry => (
                            <div key={entry.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 relative">
                                <button onClick={() => handleDelete(entry.id)} className="absolute top-4 right-4 text-slate-300 hover:text-red-500 p-2"><Trash2 size={20} /></button>
                                <div className="flex items-baseline gap-2 mb-2"><span className="text-lg font-bold text-slate-800">{entry.date}</span><span className="text-slate-500">{entry.time}</span></div>
                                <div className="flex items-center gap-2 text-lg text-blue-700 font-bold mb-2"><MapPin size={18} /> {entry.mapLink ? <a href={entry.mapLink} target="_blank" className="underline">{entry.location}</a> : entry.location}</div>
                                <div className="flex gap-3 mb-3 text-sm text-slate-600"><span className="bg-slate-100 px-2 py-1 rounded">{entry.weather}</span><span className="bg-slate-100 px-2 py-1 rounded">{entry.transport}</span>{entry.cost && <span className="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Â¥{entry.cost}</span>}</div>
                                <p className="text-slate-700 whitespace-pre-wrap text-lg">{entry.notes}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ContentView = ({ category, onBack }) => {
            const [modalContent, setModalContent] = useState(null);
            const catData = CATEGORIES.find(c => c.id === category);

            const content = {
                food: (
                    <>
                        <p className="text-lg text-slate-600 mb-6">åŒ—æµ·é“å†¬å­£æµ·é®®è‚¥ç¾ï¼Œæš–èº«æ–™ç†æ›´æ˜¯å¿…åƒã€‚ä»¥ä¸‹ç²¾é¸åœ¨åœ°ç¾é£Ÿï¼š</p>
                        <SectionTitle>å¿…åƒå››å¤§å¤©ç‹</SectionTitle>
                        <div className="space-y-4">
                            <Card onClick={() => setModalContent({title: "æˆå‰æ€æ±—çƒ¤è‚‰ (ã‚¸ãƒ³ã‚®ã‚¹ã‚«ãƒ³)", content: "â˜… ç‰¹è‰²ï¼šä½¿ç”¨ä¸­å¤®éš†èµ·çš„éµé‹ç‡’çƒ¤ç¾Šè‚‰ï¼Œè‚‰æ±æµå‘é‚Šç·£ç…®ç†Ÿè”¬èœã€‚åŒ—æµ·é“ç¾Šè‚‰ç„¡è…¥å‘³ï¼Œé®®å«©å¤šæ±ã€‚\n\nâ˜… æ¨è–¦åº—å®¶ï¼š\n1. é”æ‘© (Daruma)ï¼šæœ­å¹Œå¿…æ’éšŠè€åº—ï¼Œé†¬æ±æ˜¯ä¸€çµ•ã€‚\n2. æœ­å¹Œå•¤é…’åœ’ï¼šç’°å¢ƒæ°£æ°›ä½³ï¼Œé©åˆå¤šäººèšé¤ï¼Œå¯é †ä¾¿å–æ–°é®®å•¤é…’ã€‚\n\nâ˜… å°æ’‡æ­¥ï¼šå»ºè­°é»ä¸€ä»½ç™½é£¯ï¼Œæ­é…çƒ¤è‚‰èˆ‡é†¬æ±è¶…ä¸‹é£¯ï¼"})}>
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-orange-100 p-3 rounded-full text-2xl">ğŸ¥©</div>
                                        <div><strong className="text-lg block text-slate-800">æˆå‰æ€æ±—çƒ¤è‚‰</strong><span className="text-slate-500 text-sm">é®®å«©ç¾Šè‚‰ x ç¨é–€é†¬æ±</span></div>
                                    </div>
                                    <Info className="text-orange-400" />
                                </div>
                            </Card>
                            <Card onClick={() => setModalContent({title: "æ¹¯å’–å“© (Soup Curry)", content: "â˜… ç‰¹è‰²ï¼šæºè‡ªæœ­å¹Œçš„è—¥è†³æ¹¯åº•ï¼ŒåŠ å…¥å¤§é‡ç‚¸è”¬èœèˆ‡ä¸»é£Ÿ(å¤§é›è…¿/è±¬è§’ç…®)ã€‚\n\nâ˜… æ¨è–¦åº—å®¶ï¼š\n1. GARAKUï¼šæ¹¯é ­æ¿ƒéƒï¼Œäººæ°£ç¬¬ä¸€ï¼Œæ’éšŠååº—ã€‚\n2. Suage+ï¼šä¸²ç‡’é¢¨æ ¼ï¼Œåƒæ³•ç‰¹åˆ¥ï¼Œè”¬èœé®®ç”œã€‚\n3. å¥§èŠå•†åº—ï¼šä¸»æ‰“æ¿ƒéƒè¦æ¹¯åº•ã€‚\n\nâ˜… é»é¤æ³•ï¼š1.é¸æ¹¯åº• 2.é¸ä¸»èœ 3.é¸è¾£åº¦ 4.é¸é£¯é‡"})}>
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-yellow-100 p-3 rounded-full text-2xl">ğŸ›</div>
                                        <div><strong className="text-lg block text-slate-800">æ¹¯å’–å“©</strong><span className="text-slate-500 text-sm">æœ­å¹Œéˆé­‚ç¾é£Ÿï¼Œæš–èº«é¦–é¸</span></div>
                                    </div>
                                    <Info className="text-orange-400" />
                                </div>
                            </Card>
                            <Card onClick={() => setModalContent({title: "è±ªè¯æµ·é®®ä¸¼ & ä¸‰å¤§èŸ¹", content: "â˜… ç‰¹è‰²ï¼šå†¬å­£æ˜¯èƒèŸ¹(å¸ç‹èŸ¹ã€æ¾è‘‰èŸ¹ã€æ¯›èŸ¹)èˆ‡æµ·è†½æœ€è‚¥ç¾çš„å­£ç¯€ã€‚\n\nâ˜… æ¨è–¦åœ°é»ï¼š\n1. å‡½é¤¨æœå¸‚ï¼šå¿…ç©ã€Œé‡£æ´»çƒè³Šã€ï¼Œç¾æ®ºç¾åƒé€æ˜åˆºèº«ã€‚\n2. å°æ¨½ä¸‰è§’å¸‚å ´ï¼šæ»æ³¢é£Ÿå ‚ï¼Œè‡ªé¸é…æ–™å †æˆå±±ã€‚\n3. æœ­å¹ŒäºŒæ¡å¸‚å ´ï¼šäº¤é€šæœ€æ–¹ä¾¿ï¼Œæ—©ä¸Šä¾†ç¢—ä¸¼é£¯ã€‚\n\nâ˜… å¿…åƒï¼šæµ·è†½ã€å¹²è²ã€é®­é­šåµã€‚"})}>
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-red-100 p-3 rounded-full text-2xl">ğŸ¦€</div>
                                        <div><strong className="text-lg block text-slate-800">æµ·é®®ä¸¼ / ä¸‰å¤§èŸ¹</strong><span className="text-slate-500 text-sm">æ¥µé®®æµ·å‘³ï¼Œç—›é¢¨ä¹Ÿç”˜é¡˜</span></div>
                                    </div>
                                    <Info className="text-orange-400" />
                                </div>
                            </Card>
                            <Card onClick={() => setModalContent({title: "åŒ—æµ·é“ç”œé»", content: "â˜… å…­èŠ±äº­ï¼šè˜­å§†è‘¡è„å¤¾å¿ƒé¤…ä¹¾ï¼Œå¿…è²·ä¼´æ‰‹ç¦®ã€‚\nâ˜… LeTAOï¼šé›™å±¤ä¹³é…ªè›‹ç³•ï¼Œå°æ¨½æœ¬åº—é™å®šå£å‘³ã€‚\nâ˜… åŒ—è“æ¨“ï¼šå¦–ç²¾ä¹‹æ£®å¹´è¼ªè›‹ç³•ã€å¤¢ä¸æ€è­°æ³¡èŠ™ã€‚\nâ˜… ç™½è‰²æˆ€äººï¼šåƒè§€å·¥å» ä¸¦äº«ç”¨ç¾åšç”œé»ã€‚"})}>
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-pink-100 p-3 rounded-full text-2xl">ğŸ¦</div>
                                        <div><strong className="text-lg block text-slate-800">å¿…åƒç”œé»</strong><span className="text-slate-500 text-sm">å…­èŠ±äº­, LeTAO, åŒ—è“æ¨“</span></div>
                                    </div>
                                    <Info className="text-orange-400" />
                                </div>
                            </Card>
                        </div>
                        <SectionTitle>å¿«é€ŸæŸ¥è©¢</SectionTitle>
                        <ExtLink href="https://tabelog.com/tw/hokkaido/" label="Tabelog ç¾é£Ÿæ’è¡Œæ¦œ (ä¸­æ–‡)" color="orange" />
                    </>
                ),
                clothing: (
                    <>
                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-xl mb-6 shadow-sm">
                            <p className="text-lg font-bold text-blue-900 mb-1">ç©¿æ­é—œéµï¼šã€Œç‰ç±³å¼ç©¿æ³•ã€</p>
                            <p className="text-base text-blue-800">å®¤å…§æš–æ°£æ¥µå¼· (25Â°C)ï¼Œå®¤å¤–é›¶ä¸‹ (-5Â°C)ã€‚<br/>é‡é»æ˜¯<span className="font-bold text-red-600">ã€Œå…§è–„å¤–åšï¼Œæ–¹ä¾¿ç©¿è„«ã€</span>ï¼Œé€²å®¤å…§è„«å¤§è¡£å³å¯ã€‚</p>
                        </div>
                        <SectionTitle>å¾é ­åˆ°è…³è£å‚™æª¢æŸ¥</SectionTitle>
                        <div className="space-y-3">
                            <Card noPadding className="p-4 flex items-start gap-4">
                                <span className="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded text-sm">å…§å±¤</span>
                                <div><strong className="block text-slate-800">ç™¼ç†±è¡£</strong><span className="text-slate-600 text-sm">è²¼èº«ã€å¸æ±—ã€‚å‹¿ç©¿æ£‰è³ª(æµæ±—æœƒå†·)ã€‚</span></div>
                            </Card>
                            <Card noPadding className="p-4 flex items-start gap-4">
                                <span className="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded text-sm">ä¸­å±¤</span>
                                <div><strong className="block text-slate-800">ä¸€èˆ¬ä¸Šè¡£ / è–„æ¯›è¡£</strong><span className="text-slate-600 text-sm">å®¤å…§ç©¿é€™å±¤å‰›å¥½ã€‚é«˜é ˜åœ¨å®¤å…§å¯èƒ½å¤ªç†±ã€‚</span></div>
                            </Card>
                            <Card noPadding className="p-4 flex items-start gap-4">
                                <span className="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded text-sm">å¤–å±¤</span>
                                <div><strong className="block text-slate-800">é˜²é¢¨é˜²æ°´é•·å¤§è¡£</strong><span className="text-slate-600 text-sm">æœ€é‡è¦ï¼é•·ç‰ˆè“‹è‡€ï¼Œç¾½çµ¨å«é‡é«˜ï¼ŒGore-texå°¤ä½³ã€‚</span></div>
                            </Card>
                            <Card noPadding className="p-4 flex items-start gap-4">
                                <span className="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded text-sm">è¶³éƒ¨</span>
                                <div><strong className="block text-slate-800">é˜²æ»‘é›ªé´ + å†°çˆª</strong><span className="text-slate-600 text-sm">é‹åº•åˆ»ç´‹æ·±ã€‚å»ºè­°ç•¶åœ°è¶…å•†è²·ã€Œç°¡æ˜“å†°çˆªã€å¥—ä¸Šã€‚</span></div>
                            </Card>
                            <Card noPadding className="p-4 flex items-start gap-4">
                                <span className="bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded text-sm">é…ä»¶</span>
                                <div><strong className="block text-slate-800">æ¯›å¸½ã€åœå·¾ã€æ‰‹å¥—</strong><span className="text-slate-600 text-sm">æ¯›å¸½è¦è“‹è€³ï¼Œæ‰‹å¥—å¿…é ˆé˜²æ°´(ç©é›ªç”¨)ã€‚</span></div>
                            </Card>
                        </div>
                    </>
                ),
                payment: (
                    <>
                        <div className="bg-rose-50 p-4 rounded-xl mb-6 text-rose-800 border border-rose-100">
                            <p className="font-bold text-lg mb-2">ğŸ’¡ æ—¥æœ¬æ”¯ä»˜æ–°è¶¨å‹¢</p>
                            <p>ç¾åœ¨æ—¥æœ¬é›–ç„¶ç¾é‡‘ä»å¿…è¦ï¼Œä½†é›»å­æ”¯ä»˜å·²éå¸¸æ™®åŠã€‚å»ºè­°æº–å‚™ä»¥ä¸‹å…©ç¨®å·¥å…·ï¼Œè®“ä»˜æ¬¾æ›´æµæš¢ã€‚</p>
                        </div>

                        <SectionTitle>1. PayPay (é€éå°ç£ App)</SectionTitle>
                        <Card className="border-l-4 border-rose-500">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">å…ä¸‹è¼‰ PayPayï¼Œç›´æ¥ç”¨å°ç£ App</h3>
                            <p className="text-slate-600 mb-4">çœ‹åˆ°åº—å®¶æœ‰ç´…è‰² <span className="text-red-600 font-bold">P</span> PayPay æ¨™èªŒï¼Œå³å¯ä½¿ç”¨ä»¥ä¸‹ App æƒç¢¼ä»˜æ¬¾ï¼ˆå…æ‰‹çºŒè²»ï¼‰ï¼š</p>
                            <ul className="list-disc pl-5 space-y-2 text-slate-700">
                                <li><strong>å…¨æ”¯ä»˜ (PXPay Plus)</strong></li>
                                <li><strong>è¡—å£æ”¯ä»˜ (JKOPay)</strong></li>
                                <li><strong>ç‰å±± Wallet</strong></li>
                            </ul>
                            <div className="mt-4 bg-slate-100 p-3 rounded-lg text-sm text-slate-600">
                                <strong>æ“ä½œæ–¹å¼ï¼š</strong>é–‹å•Ÿ App > åˆ‡æ›åœ°å€è‡³ã€Œæ—¥æœ¬ã€(æˆ–é»é¸ä»˜æ¬¾ç¢¼/æƒæ) > æƒæåº—å®¶ QR Code æˆ–å‡ºç¤ºæ¢ç¢¼çµ¦åº—å®¶æƒã€‚
                            </div>
                        </Card>

                        <SectionTitle>2. è¥¿ç“œå¡ Suica (äº¤é€š/è¶…å•†)</SectionTitle>
                        <Card className="border-l-4 border-green-500">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">iPhone ç”¨æˆ¶ (è¶…ç°¡å–®)</h3>
                            <ol className="list-decimal pl-5 space-y-2 text-slate-700">
                                <li>æ‰“é–‹å…§å»º<strong>ã€ŒéŒ¢åŒ… (Wallet)ã€</strong>Appã€‚</li>
                                <li>é»æ“Šå³ä¸Šè§’ã€Œ+ã€ > é¸æ“‡ã€Œäº¤é€šå¡ã€ã€‚</li>
                                <li>æœå°‹ä¸¦é¸æ“‡ã€ŒSuicaã€ã€‚</li>
                                <li>è¼¸å…¥é‡‘é¡ (éœ€ä½¿ç”¨ Apple Pay ä¿¡ç”¨å¡ä»˜æ¬¾)ã€‚</li>
                                <li>å®Œæˆï¼æ­è»Š/è¶…å•†çµå¸³æ™‚ï¼Œ<strong>æ‰‹æ©Ÿå…è§£é–ç›´æ¥é å¡</strong>å³å¯ã€‚</li>
                            </ol>
                        </Card>
                        <Card className="border-l-4 border-green-500">
                            <h3 className="font-bold text-xl text-slate-800 mb-2">Android ç”¨æˆ¶</h3>
                            <p className="text-slate-600 mb-2">éœ€ç¢ºèªæ‰‹æ©Ÿæ˜¯å¦æ”¯æ´æ—¥æœ¬ FeliCa (å¤§éƒ¨åˆ†å°ç£å®‰å“æ©Ÿä¸æ”¯æ´)ã€‚</p>
                            <p className="text-slate-600"><strong>æ›¿ä»£æ–¹æ¡ˆï¼š</strong>ç›´æ¥è³¼è²·å¯¦é«” Suica / Kitaca å¡ï¼Œæˆ–ä½¿ç”¨ iPhone å®¶äººçš„æ‰‹æ©Ÿã€‚</p>
                        </Card>
                    </>
                ),
                transport: (
                    <>
                        <SectionTitle>éµè·¯å‘¨éŠåˆ¸ (JR Pass)</SectionTitle>
                        <Card onClick={() => setModalContent({title: "JR åŒ—æµ·é“éµè·¯å‘¨éŠåˆ¸", content: "â˜… ç¥¨åƒ¹ (7æ—¥åˆ¸)ï¼šç´„ Â¥29,000 (éœ€ä¾ç•¶ä¸‹åŒ¯ç‡)\n\nâ˜… é©ç”¨ç¯„åœï¼šJRåŒ—æµ·é“å…¨ç·š (ç‰¹æ€¥ã€å¿«é€Ÿã€æ™®é€š)ã€‚\n\nâ˜… æ˜¯å¦åˆ’ç®—ï¼Ÿ\nè‹¥è¡Œç¨‹åŒ…å«ã€Œæœ­å¹Œ â†” å‡½é¤¨ã€(ä¾†å›ç´„Â¥19,000) å†åŠ ä¸Šã€Œæœ­å¹Œ â†” æ—­å·ã€æˆ–æ©Ÿå ´ä¾†å›ï¼ŒåŸºæœ¬ä¸Šå°±å›æœ¬äº†ã€‚\n\nâ˜… é‡è¦æ³¨æ„ï¼š\nç‰¹æ€¥åˆ—è»Š (å¦‚åŒ—æ–—è™Ÿ) å…¨è»ŠæŒ‡å®šå¸­ï¼Œå‹™å¿…å…ˆå»ç¶ è‰²çª—å£æˆ–å”®ç¥¨æ©ŸåŠƒä½ï¼"})}>
                            <div className="flex justify-between items-center">
                                <div>
                                    <h3 className="text-xl font-bold text-emerald-700">åŒ—æµ·é“éµè·¯å‘¨éŠåˆ¸</h3>
                                    <p className="text-slate-500">é•·è·é›¢ç§»å‹•å¿…å‚™ (å‡½é¤¨/é‡§è·¯)</p>
                                </div>
                                <Info className="text-emerald-500" />
                            </div>
                        </Card>

                        <SectionTitle>å†¬å­£è‡ªé§•è­¦å‘Š</SectionTitle>
                        <div className="bg-red-50 border-2 border-red-200 p-5 rounded-2xl mb-6 shadow-sm">
                            <div className="flex items-center gap-2 mb-3">
                                <AlertTriangle className="text-red-600" size={28} />
                                <strong className="text-xl text-red-800">æ¥µåº¦å±éšªãƒ»æ–°æ‰‹å‹¿è©¦</strong>
                            </div>
                            <ul className="list-disc pl-5 text-lg text-red-900 space-y-2">
                                <li><strong>é»‘å†° (Black Ice)ï¼š</strong>è·¯é¢çœ‹ä¼¼æ¿•äº®ï¼Œå…¶å¯¦æ˜¯é€æ˜è–„å†°ï¼Œæ¥µæ»‘ï¼</li>
                                <li><strong>ç™½ç‰† (Whiteout)ï¼š</strong>æš´é¢¨é›ªæ™‚è¦–ç·šå®Œå…¨æ­¸é›¶ï¼Œè«‹ç«‹å³é–‹é›™é»ƒç‡ˆåœé ã€‚</li>
                                <li><strong>ã€Œæ€¥ã€ç¦ç‰©ï¼š</strong>ç¦æ­¢æ€¥ç…ã€æ€¥è½‰ã€æ€¥åŠ é€Ÿã€‚</li>
                                <li><strong>è»Šè·ï¼š</strong>è«‹ä¿æŒå¹³æ™‚çš„ 3 å€ä»¥ä¸Šã€‚</li>
                            </ul>
                        </div>
                        <ExtLink href="https://www.jrhokkaido.co.jp/global/chinese/index.html" label="JR åŒ—æµ·é“é‹è¡Œç‹€æ³" color="emerald" />
                    </>
                ),
                stay: (
                    <>
                        <SectionTitle>ä½å®¿é¡å‹æŒ‡å—</SectionTitle>
                        <Card>
                            <h3 className="font-bold text-lg text-indigo-700 mb-1">å•†å‹™é£¯åº— (Business Hotel)</h3>
                            <p className="text-slate-600 text-sm">åœ°é»ä¾¿åˆ©(è»Šç«™æ—)ï¼Œæˆ¿é–“å°ä½†åŠŸèƒ½é½Šå…¨ï¼Œåƒ¹æ ¼å¯¦æƒ ã€‚é©åˆå°‘è¡Œææ—…äººã€‚</p>
                        </Card>
                        <Card>
                            <h3 className="font-bold text-lg text-indigo-700 mb-1">æº«æ³‰æ—…é¤¨ (Ryokan)</h3>
                            <p className="text-slate-600 text-sm">é«”é©—æ¦»æ¦»ç±³ã€æ‡·çŸ³æ–™ç†èˆ‡å¤§æµ´å ´ã€‚æ¨è–¦ï¼šå®šå±±æºªã€ç™»åˆ¥ã€æ´çˆºæ¹–ã€‚</p>
                        </Card>
                        <SectionTitle>è¨‚æˆ¿å»ºè­°</SectionTitle>
                        <ul className="list-disc pl-5 text-slate-700 space-y-2">
                            <li><strong>æ—ºå­£æ—©è¨‚ï¼š</strong>é›ªç¥­æœŸé–“ (2æœˆ) æˆ¿åƒ¹é£†æ¼²ä¸”é›£è¨‚ï¼Œå»ºè­°åŠå¹´å‰é è¨‚ã€‚</li>
                            <li><strong>åœ°é»é¸æ“‡ï¼š</strong>å†¬å­£é›ªåœ°æ‹–è¡Œææ¥µç—›è‹¦ï¼Œå‹™å¿…é¸ã€Œé›¢åœ°éµ/è»Šç«™è¿‘ã€æˆ–æœ‰ã€Œåœ°ä¸‹é€£é€šé“ã€çš„é£¯åº—ã€‚</li>
                        </ul>
                    </>
                ),
                fun: (
                    <>
                        <SectionTitle>å†¬å­£é™å®šç¥­å…¸</SectionTitle>
                        <div className="space-y-4">
                            <Card>
                                <strong className="text-lg text-purple-700">â„ï¸ æœ­å¹Œé›ªç¥­</strong>
                                <p className="text-slate-600">2æœˆä¸Šæ—¬ã€‚å¤§é€šå…¬åœ’å·¨å¤§é›ªé›•ï¼Œè–„é‡å†°é›•ã€‚</p>
                            </Card>
                            <Card>
                                <strong className="text-lg text-purple-700">ğŸ•¯ï¸ å°æ¨½é›ªç‡ˆè·¯</strong>
                                <p className="text-slate-600">2æœˆä¸Šæ—¬ã€‚é‹æ²³ä¸Šæ¼‚æµ®è‘—ç‡­å…‰çƒï¼Œæ¥µåº¦æµªæ¼«ã€‚</p>
                            </Card>
                            <Card>
                                <strong className="text-lg text-purple-700">ğŸ§ æ—­å±±å‹•ç‰©åœ’</strong>
                                <p className="text-slate-600">å†¬å­£é™å®šã€Œä¼éµæ•£æ­¥ã€ï¼Œè¿‘è·é›¢çœ‹ä¼éµéŠè¡Œã€‚</p>
                            </Card>
                            <Card>
                                <strong className="text-lg text-purple-700">ğŸŒƒ å‡½é¤¨ç™¾è¬å¤œæ™¯</strong>
                                <p className="text-slate-600">å†¬å­£ç©ºæ°£æ¾„æ¾ˆï¼Œå¤œæ™¯æœ€ç¾ã€‚éœ€æ­çºœè»Šä¸Šå±±ã€‚</p>
                            </Card>
                        </div>
                    </>
                ),
                safety: (
                    <>
                        <SectionTitle>èµ°è·¯é˜²æ»‘æŠ€å·§</SectionTitle>
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <ul className="space-y-3 text-lg text-slate-700">
                                <li className="flex gap-3"><span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm">1</span><span><strong>ä¼éµæ­¥ï¼š</strong>å°æ­¥èµ°ï¼Œé‡å¿ƒå‰å‚¾ï¼Œè…³æŒæ•´å€‹è‘—åœ°ã€‚</span></li>
                                <li className="flex gap-3"><span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm">2</span><span><strong>é›™æ‰‹é¨°ç©ºï¼š</strong>çµ•å°ä¸è¦æ’å£è¢‹ï¼Œæ»‘å€’æ™‚æ‰èƒ½æ”¯æ’ã€‚</span></li>
                                <li className="flex gap-3"><span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm">3</span><span><strong>é¿é–‹äº®é¢ï¼š</strong>é–ƒé–ƒç™¼äº®çš„è·¯é¢æ˜¯å†°ï¼Œè¸©åœ¨é¬†è»Ÿç™½é›ªä¸Šè¼ƒå®‰å…¨ã€‚</span></li>
                            </ul>
                        </div>
                        <SectionTitle>ç·Šæ€¥è¯çµ¡</SectionTitle>
                        <Card className="flex justify-between items-center p-4"><span>ğŸ“ é§æœ­å¹Œè¾¦äº‹è™•</span><a href="tel:0112222930" className="text-blue-600 font-bold">011-222-2930</a></Card>
                        <Card className="flex justify-between items-center p-4"><span>ğŸš‘ æ•‘è­·è»Š/ç«è­¦</span><span className="text-red-600 font-bold text-xl">119</span></Card>
                        <Card className="flex justify-between items-center p-4"><span>ğŸ‘® è­¦å¯Ÿå±€</span><span className="text-slate-800 font-bold text-xl">110</span></Card>
                    </>
                ),
                saily: (
                    <>
                        <div className="text-center mb-6">
                            <Smartphone size={48} className="mx-auto text-pink-500 mb-2" />
                            <h3 className="text-xl font-bold text-slate-800">Saily eSIM è¨­å®š</h3>
                            <p className="text-slate-500">å…æ›å¡ï¼Œè½åœ°å³ä¸Šç¶²</p>
                        </div>
                        <SectionTitle>é—œéµæ­¥é©Ÿ</SectionTitle>
                        <div className="space-y-4">
                            <div className="flex gap-4">
                                <div className="flex-shrink-0 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center font-bold">1</div>
                                <div><strong className="block text-slate-800">åœ¨å°ç£å®‰è£</strong><span className="text-slate-600">å‡ºç™¼å‰æœ‰ç¶²è·¯æ™‚ï¼Œå…ˆè³¼è²·ä¸¦å®Œæˆ "Install eSIM"ã€‚</span></div>
                            </div>
                            <div className="flex gap-4">
                                <div className="flex-shrink-0 w-8 h-8 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center font-bold">2</div>
                                <div><strong className="block text-slate-800">æŠµé”æ—¥æœ¬å¾Œå•Ÿç”¨</strong><span className="text-slate-600">è¨­å®š > è¡Œå‹•æœå‹™ > Saily > é–‹å•Ÿã€Œå•Ÿç”¨æ­¤è™Ÿç¢¼ã€ä¸¦é–‹å•Ÿ<span className="text-red-500 font-bold">ã€Œæ•¸æ“šæ¼«éŠã€</span>ã€‚</span></div>
                            </div>
                        </div>
                        <div className="mt-8">
                            <ExtLink href="https://support.saily.com/hc/zh-tw/categories/12777342059164" label="Saily å®˜æ–¹è©³ç´°æ•™å­¸" color="pink" />
                        </div>
                    </>
                ),
                prep: (
                    <>
                       <p className="text-lg text-slate-600 mb-4">å‡ºç™¼å‰è«‹é€ä¸€æ ¸å°ï¼Œç¢ºä¿è¬ç„¡ä¸€å¤±ã€‚</p>
                       <button className="w-full bg-gradient-to-r from-teal-500 to-green-500 text-white p-4 rounded-xl text-xl font-bold shadow-lg active:scale-95 transition-transform" onClick={() => document.getElementById('checklist-btn').click()}>
                            é–‹å§‹æª¢æŸ¥æ¸…å–®
                       </button>
                    </>
                ),
                flight: (
                    <>
                        <SectionTitle>ç™»æ©Ÿ/å®‰æª¢é€ŸæŸ¥</SectionTitle>
                        <div className="space-y-4">
                            <Card className="border-l-4 border-red-500">
                                <strong className="text-lg block text-slate-800 mb-1">ğŸ”‹ è¡Œå‹•é›»æº / é‹°é›»æ± </strong>
                                <span className="text-slate-600">å¿…é ˆ<span className="text-red-600 font-bold">éš¨èº«æ”œå¸¶</span>ï¼Œåš´ç¦è¨—é‹ã€‚</span>
                            </Card>
                            <Card className="border-l-4 border-red-500">
                                <strong className="text-lg block text-slate-800 mb-1">ğŸ”¥ æ‰“ç«æ©Ÿ</strong>
                                <span className="text-slate-600">æ¯äººé™å¸¶ 1 å€‹ (å‚³çµ±å‹) éš¨èº«ã€‚é˜²é¢¨è—ç„°æ‰“ç«æ©Ÿç¦å¸¶ã€‚</span>
                            </Card>
                            <Card className="border-l-4 border-blue-500">
                                <strong className="text-lg block text-slate-800 mb-1">ğŸ§´ æ¶²é«” (éš¨èº«è¡Œæ)</strong>
                                <span className="text-slate-600">å–®ç“¶éœ€ 100ml ä»¥ä¸‹ï¼Œä¸¦è£åœ¨ 1 å…¬å‡é€æ˜å¤¾éˆè¢‹å…§ã€‚è¶…éè«‹è¨—é‹ã€‚</span>
                            </Card>
                            <Card className="border-l-4 border-blue-500">
                                <strong className="text-lg block text-slate-800 mb-1">ğŸ”ª åˆ€å‰ª / è…³æ¶</strong>
                                <span className="text-slate-600">æŒ‡ç”²å‰ªã€ç‘å£«åˆ€ã€è¶…é 60cm è…³æ¶å¿…é ˆè¨—é‹ã€‚</span>
                            </Card>
                        </div>
                    </>
                )
            };

            const defaultContent = (
                <div className="text-center py-20">
                    <p className="text-xl text-slate-400">æœ¬é é¢å…§å®¹å»ºç½®ä¸­...</p>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 pb-20 animate-fade-in">
                    <div className={`bg-gradient-to-br ${catData.color} p-6 pb-12 rounded-b-[2.5rem] shadow-lg sticky top-0 z-20 text-white`}>
                        <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold mb-4 opacity-90 active:opacity-60">
                            <ArrowLeft /> è¿”å›
                        </button>
                        <h1 className="text-4xl font-bold flex items-center gap-3">
                            {React.createElement(catData.icon, { size: 40 })}
                            {catData.title}
                        </h1>
                    </div>
                    <div className="p-5 -mt-6 relative z-30">
                        {content[category] || defaultContent}
                    </div>
                    {modalContent && <DetailModal title={modalContent.title} content={modalContent.content} onClose={() => setModalContent(null)} />}
                </div>
            );
        };

        const ChecklistView = ({ onBack }) => {
            const [checked, setChecked] = useState(() => {
                const saved = localStorage.getItem('hokkaido_checklist_v2');
                return saved ? JSON.parse(saved) : {};
            });

            const toggleCheck = (item) => {
                const newChecked = { ...checked, [item]: !checked[item] };
                setChecked(newChecked);
                localStorage.setItem('hokkaido_checklist_v2', JSON.stringify(newChecked));
            };

            const calculateProgress = () => {
                const total = CHECKLIST_ITEMS.reduce((acc, cat) => acc + cat.items.length, 0);
                const done = Object.values(checked).filter(Boolean).length;
                return Math.round((done / total) * 100);
            };

            return (
                <div className="min-h-screen bg-slate-50 pb-20 animate-fade-in">
                    <div className="bg-gradient-to-br from-teal-500 to-green-600 text-white p-6 pb-8 rounded-b-[2.5rem] shadow-lg sticky top-0 z-20">
                        <button onClick={onBack} className="flex items-center gap-2 text-xl font-bold mb-4 opacity-90 active:opacity-60">
                            <ArrowLeft /> è¿”å›
                        </button>
                        <div className="flex justify-between items-end">
                            <h1 className="text-3xl font-bold">è¡Œå‰æª¢æŸ¥æ¸…å–®</h1>
                            <span className="text-5xl font-bold">{calculateProgress()}%</span>
                        </div>
                        <div className="w-full bg-black/20 h-3 rounded-full mt-4 overflow-hidden">
                            <div className="bg-yellow-400 h-full transition-all duration-500 ease-out" style={{ width: `${calculateProgress()}%` }}></div>
                        </div>
                    </div>

                    <div className="p-5 space-y-6">
                        {CHECKLIST_ITEMS.map((cat, idx) => (
                            <div key={idx}>
                                <h3 className="text-lg font-bold text-teal-800 mb-3 ml-1 flex items-center gap-2">
                                    <span className="w-2 h-2 bg-teal-500 rounded-full"></span>
                                    {cat.category}
                                </h3>
                                <div className="bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-100">
                                    {cat.items.map((item) => (
                                        <div 
                                            key={item} 
                                            onClick={() => toggleCheck(item)}
                                            className="flex items-center p-4 border-b border-slate-50 last:border-0 active:bg-teal-50 transition-colors cursor-pointer"
                                        >
                                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center mr-4 flex-shrink-0 transition-all ${checked[item] ? 'bg-teal-500 border-teal-500 scale-110' : 'border-slate-300'}`}>
                                                {checked[item] && <CheckSquare className="text-white" size={16} />}
                                            </div>
                                            <span className={`text-lg flex-1 ${checked[item] ? 'text-slate-400 line-through decoration-slate-300' : 'text-slate-700'}`}>
                                                {item}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [view, setView] = useState('home');
            
            useEffect(() => {
                const handlePopState = (event) => setView(event.state?.view || 'home');
                window.addEventListener('popstate', handlePopState);
                return () => window.removeEventListener('popstate', handlePopState);
            }, []);

            const navigate = (newView) => {
                window.history.pushState({ view: newView }, '', '');
                setView(newView);
                window.scrollTo(0, 0);
            };

            if (view === 'checklist') return <ChecklistView onBack={() => navigate('home')} />;
            if (view === 'diary') return <DiaryView onBack={() => navigate('home')} />;
            if (view !== 'home') return <ContentView category={view} onBack={() => navigate('home')} />;

            return (
                <div className="min-h-screen bg-slate-50 pb-10">
                    <div className="bg-gradient-to-br from-blue-600 to-indigo-700 p-6 pb-12 rounded-b-[3rem] shadow-xl mb-6 text-white relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-16 -mt-16 blur-3xl pointer-events-none"></div>
                        <h1 className="text-3xl font-bold mb-1 text-center drop-shadow-md">åŒ—æµ·é“å†¬å­£æ—…éŠ</h1>
                        <p className="text-blue-200 text-center text-sm tracking-widest uppercase mb-6">Hokkaido Winter Guide</p>
                        <TimeWidget />
                    </div>

                    <div className="px-5 -mt-8 relative z-10">
                        <WeatherWidget />
                        
                        <div className="grid grid-cols-2 gap-4">
                            {CATEGORIES.map(cat => (
                                <div 
                                    key={cat.id}
                                    onClick={() => navigate(cat.id === 'prep' ? 'checklist' : cat.id === 'diary' ? 'diary' : cat.id)}
                                    id={cat.id === 'prep' ? 'checklist-btn' : ''}
                                    className={`bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 aspect-[1.1] active:scale-95 transition-transform cursor-pointer relative overflow-hidden group`}
                                >
                                    <div className={`absolute top-0 right-0 w-16 h-16 bg-gradient-to-br ${cat.color} opacity-10 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110`}></div>
                                    <div className={`p-3 rounded-full bg-gradient-to-br ${cat.color} text-white shadow-lg`}>
                                        {React.createElement(cat.icon, { size: 28 })}
                                    </div>
                                    <span className="font-bold text-lg text-slate-700">{cat.title}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <footer className="mt-16 text-center text-slate-400 text-sm pb-8 px-8">
                        <div className="w-12 h-1 bg-slate-200 mx-auto rounded-full mb-4"></div>
                        <p className="mb-2">ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼æ³¨æ„ä¿æš–èˆ‡å®‰å…¨ã€‚</p>
                        <p className="text-xs opacity-60">Copyright Â© 2025 æ§‹æ€by Carey | å¯¦ç”¨å°å·¥å…·</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>